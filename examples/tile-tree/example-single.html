<script src="../../juse-up.js" data-app="main.html@context"></script>

<style>
#toggle.tree { width:16px; height:16px; display:inline-block; background: url(static/app/plus.gif) no-repeat 1px 1px; }
#toggle.tree.open { background-image: url(static/app/minus.gif); }

#label.tree { padding-left:20px; background: no-repeat 0px 1px; }
#label.tree.folder { background-image: url(static/app/folder.png); }
#label.tree.folder.open { background-image: url(static/app/folder_open.png); }

#content.tree { padding-left:19px; display:none; }
#content.tree.open { display:block; }
</style>

<div id="main.html">
	<div data-tree="label=one">
		<div data-tree="label=two">
			<div data-tree="label=three">
				<span>done</span>
			</div>
		</div>
	</div>
</div>
<div id="app/tree.html">
	<div data-widget="tree">
		<span id="toggle" class="tree"></span>
		<span id="label" class="tree folder">${label}</span>
		<div id="content" class="tree placeholder">
			<div data-tag></div>
		</div>
	</div>
</div>

<script type="text/javascript">
juse("context.context", ["juse/ui", "juse/resource"], function(){
	this.juse("main.html|app/tree|widget", ["app/tree.html"]);
	
	this.juse("app/tree", ["tile"], function($tile){
		return juse.seal(function tree(node, dataset){
			return $tile.call(this, node, dataset, "tree");
		}, {bindWidget:bindWidget});

		function bindWidget(node) {
			[].forEach.call(node.querySelectorAll(".tree"), bind);
		}

		function bind(node) {
			switch (node.id) {
			case "toggle":
				juse.follow(node, {"click":toggle});
				break;
			case "label":
				juse.follow(node, {"dblclick":toggle});
				break;
			}
		}

		function toggle(event) {
			var node = event.target;
			switch (node.id) {
			case "toggle":
				toggleClass(node, "open");
				toggleClass(node.nextElementSibling, "open");
				toggleClass(node.nextElementSibling.nextElementSibling, "open");
				break;
			case "label":
				toggleClass(node, "open");
				toggleClass(node.nextElementSibling, "open");
				toggleClass(node.previousElementSibling, "open");
				break;
			}
		}

		function toggleClass(node, name) {
			var list = node.className.split(" ");
			var i = list.indexOf(name);
			if (i < 0) node.className = node.className + " " + name;
			else {
				list.splice(i,1);
				node.className = list.join(" ");
			}
		}

	});
});
</script>
