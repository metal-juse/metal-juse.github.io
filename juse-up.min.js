/**
 * Another AMD inspired JavaScript framework to load modules and manage dependencies.
 */
!function(){var e=["spec","refs","value"],t=["kind","name","type","context"],n=["key","kind","name","type","member","context","pipe","value"],r=[""].concat(n),s=/(?:\s*([^.#@|;\s]*)\s*=)?(?:\s*([^.#@|;\s]*)\s*:)?\s*([^.#@|;]*)(?:\.([^#@|;\s]*))?(?:#([^@|;\s]*))?(?:@([^|;\s]*))?(?:\s*\|\s*([^;\s]*))?(?:\s*;\s*([\S\s]*))?/,o=["=",":","",".","#","@","|",";"],i=["","name","value"],u=/function\s*([\S]*?)\s*\([^)]*\)\s*{\s*(?:\/\*\*+\s*([\S\s]*?)\s*\*\*+\/)?/,a=/^[\s*]*@([^\s]+)[ \f\r\t\v]*([^\n]*\S)?\s*/,c=se(["BUFFER","LOAD","DEFINE","RESOLVE","READY","FLUSH","DONE","ERROR"]),l=se(["error","warn","info","debug"]),f={buffer:[],errors:[],flushCount:0,moduleCount:0,global:this.document?this:this.global||this};return function(){f.global.juse||(ae(f.global,{juse:p,define:f.global.define||p}),f.global.document?(ae(f,{doc:f.global.document,async:!!f.global.document.currentScript,script:Q()}),ae(f,{jusePath:re(f.script.getAttribute("src"),-1),app:te(f.script.getAttribute("data-app")||"")}),f.doc.head!=f.script.parentNode&&f.doc.head.appendChild(f.script)):ae(f,{jusePath:__dirname,app:te(process.argv[2]||"")}),p(".context",function(){function e(e,t){return e=te(e),j(t&&t.spec||W()).scope.property(e)||me(t,["properties",e.name])}function t(e,t){return O(e,E(t&&t.spec||W()))}function n(e,n){return me(E(e=t(e,n)),["value",e.member])}function r(e,n,r){var s=te(e);if(s){var o=E(n&&n.spec||W());return r=void 0===r?C.call(o,t(s,n)):D(me(r=D(r,s,"type",o),[s.member]),s,"pipe",o)}}this.juse(function(){return oe(this.context.juse,{global:f.global,toRef:te,toPath:ee,toSpec:ne,slicePath:re,property:e,resolve:t,lookup:n,filter:r,member:me,typeOf:de,valueOfKey:he,follow:le,assign:ie,copy:ae,seal:oe,log:ve})}),this.juse("juse/cache",function(){return ie(this,{init:e}),oe(function(e){ae(E(this.spec).cache,e)},{init:e});function e(){E(this.spec).cache={},ie(this,{cacheEntry:n,cacheValue:t})}function t(e,t,n){var r=this.cacheEntry(e);return void 0!==n&&(r[t]=r[t]||n),r[t]}function n(e,t){var n=E(this.spec).cache;return n[e]=n[e]||t||{}}}),this.juse("juse/context",["cache"],function(e){return ie(this,{init:t}),t.call(this.context),e.call(this.context,n({map:{"*":"modules:",context:"juse/context@",cache:"juse/cache@",juse:"juse@"},roots:["juse","jx"]})),function(t){return ae(this.cacheEntry("properties"),me(t,"properties")),e.call(this,n(t)),{}};function t(){e.init.call(this),ie(this,{property:s})}function n(e){return e&&e.map&&r(e.map),e&&e.remap&&Object.keys(e.remap).map(he,e.remap).forEach(r),e}function r(e){e&&ae(e,Object.keys(e).map(he,e).map(te),Object.keys(e),!0,!0)}function s(e,t){var n=(e=te(e)).kind?this.cacheValue("properties",e.kind,{}):this.cacheEntry("properties"),r=me(n,[e.name,e.member]);return r||void 0===t||(r=n[e.name]=n[e.name]||(e.member?{}:t),e.member&&(r=r[e.member]=r[e.member]||t)),r}}),this.juse("juse/request",function(){return function(t){return f.doc?"css"==t.type?e(t):"static"==t.kind?function(e){var t={ref:e,xhr:new XMLHttpRequest};try{t.xhr.open("GET",ee(e),!0),t.xhr.onreadystatechange=n.bind(t),t.xhr.send()}catch(e){t.error=e,n.call(t)}}(t):e(t):function(e){var t=ee(e);ve("load:",ne(e),"<-",t),f.currentSpec=e,require(t);var n=E(e);pe(n)&&(n.flushState=c.DEFINE)}(t)};function e(e){var n=ee(e),r=ne(e),s="css"==e.type?"link":"script",o=f.doc.createElement(s);o.setAttribute("data-spec",r),"link"==s?(o.rel="stylesheet",o.href=n,o.title=r,n=o.href):(o.async=f.async,o.src=n,n=o.src),ve("load:",r,"<-",n),le(o,{load:t,error:t}),f.script.parentNode.insertBefore(o,f.script)}function t(e){var t=b(te(J(e.target)));M(t)&&("load"==e.type?"css"==t.type?t.flushState=c.DONE:pe(t)&&(t.flushState=c.DEFINE):K(t,null,null,Error("response "+e.type)),A())}function n(){(this.error||4==this.xhr.readyState)&&(200==this.xhr.status||0==this.xhr.status&&this.xhr.responseText?this.value=this.xhr.responseText:this.error||(this.error=Error(this.xhr.statusText||"Not Found"),this.error.code=this.xhr.status||404),this.error?K(b(this.ref),null,null,this.error):p(this.ref,this.value))}})}),f.doc?le(f.global,{load:h,hashchange:h}):h())};function d(){f.doc?ve(f):ve(f.jusePath,f.app),ve("--done--")}function h(){j().scope.juse(f.doc?["juse/core","juse/ui"]:["juse/core"],function(){j().scope.juse(["map@juse/core"],function(e){var t=te(f.doc?f.global.location.hash.substring(1):"",W()),n=te(t.context||""),r=e(t.value);f.appPath=n.kind||te(f.app.context||"").kind,ae(t,{context:n.name||t.context||"",value:""},null,!0,!0),j().scope.juse([te(t.context,".context")],function(){ae(j(W(t)).scope.cacheEntry("properties"),r),ve("--load--"),j().scope.juse([t,"load@juse/core"],function(e,n){var r=de(e,"function")?e():e;n.fire("load",r),n.fire("done",t)||setTimeout(d)})})})})}function p(t,n,r){var s=m(f.doc?te(J(Q())):f.currentSpec,function(t,n,r){n<e.length&&(de(t[0],"array")?t.unshift(""):n<2&&(r==f.global||de(t[0],"function"))?t.unshift("",null):de(t[1],"array")||t.splice(1,0,null));return ae({},t,e)}([t,n,r],arguments.length,this),this),o=E(s);o&&function(e){return e.flushState==c.ERROR}(o)&&k(s),o&&!M(o)||(ve("define:",ne(s)),o=v(s,c.DEFINE),f.context=f.context||o,this!=f.global&&1!=f.buffer.length||A())}function m(e,t,n){var r=n?{properties:{},args:t,refs:[]}:{args:{},spec:e};return n&&(r.value_=function(e,t){var n=de(t,"function")&&u.exec(f.global.juse.toString.call(t));ae(e,n,i),t=e.value,delete e.value;for(;n=a.exec(t);){var r=n[1],s=n[2]||"";e[r]?(de(e[r],"array")||(e[r]=[e[r]]),e[r].push(s)):e[r]=s,t=t.substring(n.index+n[0].length)}return t}(r.properties,r.args.value),r.spec=ae(te(r.args.spec,e),{name:r.properties.name})),n&&f.context&&(n!=f.global?r.spec=te(r.args.spec,{name:r.properties.name,context:n.spec.name}):"static"==r.spec.kind?(r=E(r.spec).def).args.value=t.value:ae(r.spec,R(r.spec,r.spec,!0))),ae(r,r.spec)}function v(e,r){var s=E(e)||{};if(ae(s,e,n,!0,!0),s.def=e,s.flushState=r,!E(e)){if(s.id=f.moduleCount++,!k(e,s))return;s.scope={spec:ae({},s.def.spec,t),properties:ae({},s.def.properties)},f.buffer.push(s)}return"context"==s.type?(s.modules={},s.scope.define=s.scope.juse=p):s.scope.context=j(s).scope,s}function j(e,t){var n=de(e,"object")?e.context||t:e;return n?me(f.context,["modules",n]):f.context}function b(e){var t={ref:e};return E(e)||f.buffer.some(y,t)&&t.module}function y(e){return this.module=e,Object.keys(this.ref).every(g,this)}function g(e){return this.ref[e]===this.module[e]}function E(e,t,n,r){return"context"==e.type?j(e.name):de(x(e),"string")&&me(j(e,r),["modules",x(e)])}function x(e,t){var n=de(e,"object")?e.name:e;return(t=e.type&&"context"!=e.type&&"js"!=e.type?e.type:t)?[n,t].join("."):n}function k(e,t){if(e.name){var n=j(e);if(n)n.modules[x(e)]=t;else if(e.context)return void ve("warn","undefined context:",e.context)}return t}function T(e){var t=O(e,this);return t.value&&(t.value=p.lookup("replace@juse/core")(t.value,this.scope)),t}function N(e){return O(e,this,!0)}function O(e,t,r){var s=te({},e);if(!s.name||!t)return s;var o=!r&&E(s,0,0,t.context),i=R(s,t,!0);if(i||!o||o==t){if(i=i||R(s,t),r&&!i)return;ae(s,i,n,!0,!0),i||(s.name=function(e,t){return["context"in e||e.name.indexOf("/")>=0?null:re(t.name,-1)].concat(e.name.split("/")).filter(me).join("/")}(s,t))}return s.type&&ae(s,R(x("*",s.type),t)),(s.context||t.context||"context"==t.type||Z(s.name))&&ae(s,R("*",t)),ae(s,{kind:t.kind||j(t).kind,context:t.context})}function R(e,t,n){var r=de(e,"object")?x(e,e.type):e,s=x(t,t.type),o=me(j(f.app),["cache","remap",s,r])||me(j(t),["cache","remap",s,r]);return n?o:o||me(j(f.app),["cache","map",r])||me(j(t),["cache","map",r])||t.name&&function(e,t){var n={refKey:t};return j(e).refs.some(S,n)&&n.value}(t,r)||me(j(),["cache","map",r])}function S(e){return this.value=me(E(e),["cache","map",this.refKey])}function C(e){var t=e&&E(e);if(t){var n=t.value;return e.member&&e.member!=t.member&&(n=me(n,[e.member])),D(n,e,"pipe",this)}}function w(e,t,n){var r="type"==t?".":"|",s="type"==t?N:T;return e&&e[t]?e[t].split(r).map(s,n).filter(me):[]}function D(e,t,n,r,s){return w(t,n,r).map(E).reduce(L,{scope:r.scope,value:e,kind:te(s)}).value}function L(e,t){return t=e.kind?me(t,[e.kind.name,e.kind.member]):me(t,"value"),e.value=de(t,"function")&&t.call(e.scope,e.value)||e.value,e}function A(){clearTimeout(f.flushTimeout),f.buffer.filter(q).filter(H).forEach(X),f.buffer.some(U)||f.buffer.filter(H).forEach(X),f.buffer.some(M)||f.buffer.forEach(z),!f.async&&f.buffer.some(V)||f.buffer.some($),f.flushCount>f.moduleCount?(ve(f),ve("--timeout--")):f.buffer.some(V)?(f.flushCount++,f.flushTimeout=setTimeout(G,1e3)):(f.buffer=f.buffer.filter(I),f.buffer.length&&!f.buffer.some(V)?(f.flushCount++,A()):f.buffer.length||(f.flushCount=0))}function M(e){return e.flushState<c.DEFINE}function V(e){return e.flushState==c.LOAD}function F(e){return e.flushState>=c.READY}function I(e){return e.flushState<c.DONE}function _(e){return e.flushState>=c.FLUSH}function q(e){return"context"==e.type}function U(e){return q(e)&&(e.flushState==c.READY||e.flushState==c.FLUSH)}function B(e){return _(e)&&(!e.modules||Object.keys(e.modules).map(he,e.modules).every(_))}function H(e){if(e.flushState==c.DEFINE||e.flushState==c.RESOLVE)return e.flushState=c.RESOLVE,e.def.spec.type&&ae(e.def.spec,R(x("*",e.def.spec.type),e)),e.refs=[],e.def.args.refs&&(e.def.refs=e.def.args.refs.map(T,e),e.refs.push.apply(e.refs,e.def.refs.filter(me)),e.def.refs.forEach(P,e)),e.refs.push.apply(e.refs,w(e.def.spec,"type",e)),P.call(e,e.def.spec),!0}function P(e){this.refs.push.apply(this.refs,w(e,"pipe",this))}function X(e){if(e.flushState==c.RESOLVE){if(!e.refs.every(E)&&!j(e).refs.map(E).every(B))return;e.flushState=c.READY,e.refs.forEach(Y,e),(de(e.value,"string")&&e.value&&!pe(e)||"static"==e.def.spec.kind&&!e.def.args.value)&&(e.flushState=c.BUFFER),e.name&&!e.type&&e.scope.context.cacheValue&&e.scope.context.cacheValue("map",re(e.name,-1,1),e.scope.spec)}}function Y(e){e&&!E(e)&&(ve("buffer:",ne(e),"by",ne(this)),pe(e)?v(m(e),c.DEFINE):v(m(e),c.BUFFER)||ve("warn","fail to buffer",ne(e),"by",ne(this)))}function $(e){if(e.flushState==c.BUFFER)return e.flushState=c.LOAD,p.lookup("juse/request@")(e.def.spec),!f.async}function K(e,t,n,r){(r||M(e))&&(e.flushState=c.ERROR,e.value=r||Error("timeout error"),f.errors.push(e.value),ve("error",ne(e.def),e.value))}function G(){f.buffer.forEach(K),A()}function z(e){if(e.flushState==c.READY||e.flushState==c.FLUSH){var t=e.refs.map(b).filter(me);if(e.flushState==c.READY){if(!t.every(F))return;e.flushState=c.FLUSH,t.forEach(z)}if(e.flushState==c.DONE)return;if(!t.every(_))return;if(!j(e).refs.map(E).every(B))return;try{ve("init:",ne(e.def)),function(e){if(D(e.value,e.def.spec,"type",e,"scope#init"),D(e.value,e.def.spec,"pipe",e,"scope#init"),e.value=(de(e.def.args.value,"function")?e.def.value_:e.def.args.value)||pe(e),de(e.def.args.value,"function")){var t=e.def.refs.map(C,e);t.push(e.scope),e.scope.value=e.value,e.value=e.def.args.value.apply(e.scope,t)||e.value,delete e.scope.value}e.value=D(e.value,e.def.spec,"type",e),e.value=D(e.value,e.def.spec,"pipe",e)}(e),e.flushState=c.DONE}catch(t){K(e,0,0,t)}}}function J(e){return e.getAttribute("data-spec")}function Q(e){return f.global.document.currentScript||f.script&&f.script.previousElementSibling||(e=f.global.document.getElementsByTagName("script"))[e.length-1]}function W(e){return f.currentApp=e||f.currentApp,f.currentApp||f.app}function Z(e){return!f.context.cache||f.context.cache.roots.indexOf(e.split("/")[0])>=0}function ee(e){var t=te(e),n=t.value;if(!n){var r=j(t),s=x(t,"js");n=[Z(s=r.kind?[r.name,s].join("/"):s)||f.doc?"":".",n=Z(s)?f.jusePath:f.appPath,t.kind,s].filter(me).join("/")}return n}function te(e,t,o){return de(e,"string")&&(e=ae({},s.exec(e),r)),de(t,"string")&&(t=ae({},s.exec(t),r)),de(t,"object")||(t=null),(e=ae(e,t,o=de(o,"array")&&o||o&&e&&Object.keys(e)||n,!0))&&e.name&&(e.name=e.name.trim()),e}function ne(e){for(var t=[],r=0;r<n.length;r++){var s=e[n[r]],i=o[r];(s||"string"==typeof s&&i)&&(r>1?t.push(i,s):t.push(s,i))}return t.join("")}function re(e,t,n,r){if(!e)return e;t=t||0,r=r||"/";var s=e.split(r),o=(n=arguments.length>2?n:t<0?t:s.length-t)>0;n=n>0?n:-n;var i=s.splice(t,n);return(o?i:s).join(r)}function se(e){for(var t=0;t<e.length;t++)e[e[t]]=t;return oe(e)}function oe(e,t){return Object.freeze(ie.apply(this,arguments))}function ie(e,t){if(!e||!t)return e;for(var n=1;n<arguments.length;n++)ue.call(e,arguments[n]);return e}function ue(){for(var e=0;e<arguments.length;e++){var t=arguments[e],n=de(t,"function")&&u.exec(f.global.juse.toString.call(t))[1];n?ce(this,n,t):de(t,["array","arguments"])?ue.apply(this,t):ae(this,t)}}function ae(e,t,n,r,s){if(!e||!t)return e;for(var o=de(t,["array","arguments"])?n:Object.keys(t),i=0;i<o.length;i++){var u=o[i];ce(e,u,o===n?t[i]:t[u],n,r,s)}return e}function ce(e,t,n,r,s,o){t&&(r&&r.indexOf(t)<0||(n||"string"==typeof n)&&(e.propertyIsEnumerable(t)&&!s||e[t]&&!o||(e[t]=n)))}function le(e,t){Object.keys(t).forEach(fe,{target:e,follower:t})}function fe(e){this.target.addEventListener(e,this.follower[e])}function de(e,t,n){var r=typeof e;return"object"==r&&(r=(r=f.toString.call(e)).substring(8,r.length-1).toLowerCase()),t?n?0==r.indexOf(t):f.buffer.constructor===t.constructor?t.indexOf(r)>=0:t==r:r}function he(e){return this[e]}function pe(e){return f.doc&&f.doc.getElementById(e.member||e.name)||me(f.global,e.member||e.name)}function me(e,t,n){var r;if(t=de(t,"string")?t.split("."):t)for(var s=0;s<t.length&&(de(r=t[s],"string")&&e);s++)e=!de(e,"string")&&r in e?e[r]:r=null;return!0===n?de(r,"string")&&r:e}function ve(e){if("undefined"!=typeof console){var t=j(W());if(me(t,["scope","property"])&&"dev"==t.scope.property("app-mode"))if("string"==typeof e){var n=l.indexOf(e);(n<0?console.log:console[l[n]]).apply(console,arguments)}else console.dir(e)}}}()(),juse("juse/resource.context",function(){this.juse("properties",function(){return function(e){if(juse.member(e,"kind",!0)){var t=e.kind||juse.slicePath(this.spec.name,-1,1);juse.copy(this.context.cacheValue("properties",t,{}),e)}else juse.copy(this.context.cacheEntry("properties"),e)}}),this.juse("json",function(){return function(e){return JSON.parse(e)}}),this.juse("html",function(){return function(e,t){if(juse.typeOf(e,"html",!0))return e;var n=juse.global.document.createElement(t||"div");return n.innerHTML=e,n}})}),juse("juse/run.context",function(){this.juse("try",function(){return function(e,t,n,r){try{return e.apply(r,t)}catch(e){return n&&(n.ex=e),n}}}),this.juse("async",["try"],function(e){var t="function"==typeof setImmediate?setImmediate:setTimeout,n=[];return function(e){n.length||t(r),n.push(e)};function r(){for(var t={};n.length;)e(n.shift(),null,t)===t&&juse.log("error",t.ex)}}),this.juse("promise",["try","async"],function(e,t){var n,r={};return juse.seal(s,{resolve:function(e){return s(function(t,n){t(e)})},reject:function(e){return s(function(t,n){n(e)})}});function s(t){if("function"!=typeof t)throw TypeError("not a function: "+t);var n=i();return e(c,[n,t],r)===r&&d(n,"rejected",r.ex),n.handle}function o(e,t){return e&&e[t]}function i(e,t,r){var s={depth:0};return s.handle=new function(e,t){this.then=e,this.catch=t}(u.bind(s),u.bind(s,null)),e&&(e.children=e.children||[],e.children.push(s),s.fulfilled=t,s.rejected=r),n&&(n.inner=s,s.outer=n),s}function u(e,t){var n=i(this,e,t);return f.call(this,n),n.handle}function a(e,t,n){this.depth>=e||this.state||(this.depth=e,d(this,t,n)&&l(this))}function c(e,t,n){t.call(n,a.bind(e,e.depth+1,"fulfilled"),a.bind(e,e.depth+1,"rejected"))}function l(e){e.state&&(e.children?e.children.forEach(f,e):e.outer&&f.call(e,e.outer))}function f(s){var o=this;o.state&&!s.state&&t(function(){(function(t,s){if(!s.state||t.state)return;var o=s.state,i=s.value;"function"==typeof t[o]&&(n=t,(i=e(t[o],[i],r))!==r?o="fulfilled":(i=r.ex,o="rejected"),n=null);return d(t,o,i)})(s,o)&&l(s)})}function d(t,n,s){if(t.handle===s)s=TypeError("cyclic promise"),n="rejected";else if(t.inner&&t.inner.handle===s)for(var i=t.inner;i;){if(i.state){n=i.state,s=i.value;break}i=i.inner}var u=e(o,[s,"then"],r);if(u===r&&(s=r.ex,n="rejected"),"function"==typeof u&&("object"==typeof s||"function"==typeof s)&&"fulfilled"==n){var a=t.depth;if(e(c,[t,u,s],r)!==r||a<t.depth)return!1;s=r.ex,n="rejected"}return t.state=n,t.value=s,!0}})}),juse("juse/remote.context",["run"],function(){function e(e){this.xhr.setRequestHeader(e,this.args.headers[e])}function t(e){return juse.typeOf(e,"object")?Object.keys(e).map(n,e).join("&"):e}function n(e){return[encodeURIComponent(e),encodeURIComponent(this[e])].join("=")}this.juse("request",["promise"],function(n){return function(r,s){var o={spec:r,url:juse.toPath(juse.resolve(r,this)),args:s||{},scope:this};return n(function(n,r){try{(function(n,r){this.xhr=new XMLHttpRequest;var s=(this.args.method||"GET").toUpperCase();switch(s){case"GET":this.data=null,this.xhr.open(s,[this.url,t(this.args.data)].filter(juse.member).join("?"),!0);break;case"POST":this.data=t(this.args.data),this.xhr.open(s,this.url,!0),this.xhr.setRequestHeader("Content-Length",this.data.length),this.xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");break;default:throw Error("method not supported: "+s)}this.xhr.onreadystatechange=function(e,t){if(4==this.xhr.readyState){if(200==this.xhr.status||0==this.xhr.status&&this.xhr.responseText)try{this.value=juse.filter(this.spec,this.scope,this.xhr.responseText)}catch(e){this.error=e}else this.error=Error(this.xhr.statusText||"Not Found"),this.error.code=this.xhr.status||404;this.error?t.call(this.scope,this.error):e.call(this.scope,this.value)}}.bind(this,n,r),this.args.headers&&Object.keys(this.args.headers).forEach(e,this);return this.xhr}).call(this,n,r).send(this.data)}catch(e){r.call(this.scope,e)}}.bind(o))}})}),juse("juse/core.context",["juse/run"],function(){this.juse("replace",function(){var e=/\$\{([^\}]+)\}/g,t=/\$\{([^\}]+)\}/;return function(n,r){return n&&"string"==typeof n&&t.test(n)?n.replace(e,function(e,t){return juse.property(t,r)||e}):n}}),this.juse("map",function(){return function(e){for(var t={},n=juse.toRef(e);n&&n.name;n=juse.toRef(n.value))t[n.key||""]=n.name;return t}}),this.juse("event",["cache"],function(e){return juse.assign(this,{init:t}),juse.seal(function(e){return juse.seal(e||function(){},{addEventListener:this.addEventListener.bind(this),follow:this.follow.bind(this),fire:this.fire.bind(this)})},{init:t});function t(){e.init.call(this),juse.assign(this,{addEventListener:n,follow:r,fire:s})}function n(e,t){juse.typeOf(t,"function")&&i(e,this).push(t)}function r(e){juse.follow(this,juse.assign({},arguments))}function s(e,t,n){var r={value:t,error:n};return i(e,this).forEach(o,r),r.result}function o(e){try{this.result=this.result||e(this.value,this.error)}catch(e){juse.log("error",e)}}function i(e,t){return t.cacheValue("callbacks",e,[])}}),this.juse("load|event",function(){}),this.juse("service",["event","promise"],function(e,t){return juse.assign(this,{init:function(){e.init.call(this),juse.assign(this,{provide:n,submit:r})}}),function(e){return juse.seal(e||function(){},{addEventListener:this.addEventListener.bind(this),follow:this.follow.bind(this),fire:this.fire.bind(this),provide:this.provide.bind(this),submit:this.submit.bind(this)})};function n(e){return juse.assign(this.cacheEntry("providers"),arguments)}function r(e,n){var r=juse.toRef(e),s=juse.member(this.provide(),r.member),o={value:n};return t(s.bind(o)).then(t.resolve,t.reject)}})}),juse("juse/text.context",["juse/core"],function(){this.juse("replace",["teval"],function(e,t){var n=/\$\{([^\}]+)\}/g,r=/\$\{([^\}]+)\}/;return function(s,o){e=e||juse.lookup("teval",t);var i=this,u=arguments;return s&&"string"==typeof s&&r.test(s)?s.replace(n,function(t,n){var r=t,s=parseInt(n)+1;return s?s in u&&(r=u[s]):r=e.call(i,n,o)||r,r}):s}}),this.juse("teval",["replace","map"],function(e,t,n){return function(n,r){var s=juse.toRef(n),o=juse.property(s,this)||juse.filter(s,this,r),i=juse.filter(s.value,this)||t(s.value);if(i){o=juse.typeOf(o,"array")&&!o.length||juse.typeOf(o,"object")&&!Object.keys(o).length?null:o;var u=juse.member(i,[o],!0)?juse.member(i,[o]):o&&"*"in i?i["*"]:!o&&""in i?i[""]:o;u!==o&&(o=e.call(this,u,o))}return o}})}),juse("juse/ui.context",["juse/resource","juse/text","juse/core"],function(){var e,t,n=[];this.juse("view",["html","load"],function(n,r,s){return r.follow({load:function(r){e=e||juse.global.document.body.querySelector("[data-view]")||juse.global.document.body,r=n(r),t.closest(r,e)||(e.lastElementChild?e.replaceChild(r,e.lastElementChild):e.appendChild(r))}}),function(){s.context.cacheValue("views",this.spec.name,this.spec)}}),this.juse("dom",["html"],function(e){return t=juse.seal(function(t,n){return juse.typeOf(t,"string")?e.call(this,t):n?t.cloneNode(!0):t},{TEXT_NODE:juse.global.document.TEXT_NODE,ELEMENT_NODE:juse.global.document.ELEMENT_NODE,ATTRIBUTE_NODE:juse.global.document.ATTRIBUTE_NODE,moveContent:r,replaceContent:function(e,t){e&&e.parentNode&&t&&(r(t,e),e.parentNode.removeChild(e))},removeContent:function(e){if(juse.typeOf(e,"array"))e.forEach(o);else for(;e.firstChild;)o(e.firstChild)},childNodes:function(e,t){return t?e?i(e.childNodes,{name:t,nodes:{}}).nodes:{}:n.slice.call(e.childNodes)},forNodes:function(e,t,n,r){r={name:t,nodes:[e.childNodes],callback:n,scope:r};for(var s=0;s<r.nodes.length;s++)i(r.nodes[s],r)},closest:function(e,t){for(var r={selectors:t},s=e.parentNode;s;s=s.parentNode)if(e=n.some.call(s.childNodes,a,r)&&r.node)return e},filterNodes:function(e,r){var s=(r=r||e.nodeType!=t.ELEMENT_NODE&&"*")?e.querySelectorAll(r):e.getElementsByTagName("*");return n.slice.call(s)},data:function(e,n,r){if(e.nodeType==t.ELEMENT_NODE){var s=e.getAttribute(n);return null===r?e.removeAttribute(n):void 0!==r&&e.setAttribute(n,r),s}},textNode:c,forTextNodes:function(e,t,r){e&&n.filter.call(e,c).forEach(t,r)},toggleClass:function(e,t,n){var r=e.className?e.className.split(" "):[],s=r.indexOf(t);n&&s<0?r.push(t):!n&&s>=0&&r.splice(s,1);t=r.join(" "),e.className!=t&&(e.className=t)}});function r(e,t){if(t="string"==typeof(t=t||juse.global.document.createDocumentFragment())?juse.global.document.createElement(t):t,juse.typeOf(e,"array"))e.forEach(s,t);else for(;e.firstChild;)s.call(t,e.firstChild);return t}function s(e){this.parentNode?this.parentNode.insertBefore(e,this):this.insertBefore(e,null)}function o(e){e.parentNode&&e.parentNode.removeChild(e)}function i(e,t){return n.reduce.call(e,u,t)}function u(e,n){return n.nodeType==t.ELEMENT_NODE&&(e.callback?(e.name&&!n.hasAttribute(e.name)||e.callback.call(e.scope,n),e.nodes.push(n.childNodes)):n.hasAttribute(e.name)&&(e.nodes[n.getAttribute(e.name)]=n)),e}function a(e){if(e.nodeType==t.ELEMENT_NODE){var n="string"!=typeof this.selectors?e===this.selectors:e.matches?e.matches(this.selectors):e.parentNode.querySelector(this.selectors)==e;return this.node=n&&e}}function c(e){return e.nodeType==t.ATTRIBUTE_NODE||e.nodeType==t.TEXT_NODE}}),this.juse("replace",["dom","replace@juse/text"],function(e,t){return function(t,n){var s={scope:this,dataset:n};return e.filterNodes(t).forEach(r,s),r.call(s,t),t};function r(t){t.nodeType==e.ELEMENT_NODE&&(n.forEach.call(t.attributes,s,this),n.forEach.call(t.childNodes,s,this))}function s(n){n.nodeType!=e.ATTRIBUTE_NODE&&n.nodeType!=e.TEXT_NODE||(n.nodeValue=t.call(this.scope,n.nodeValue,this.dataset))}}),this.juse("tile",["dom","replace","map"],function(e,t,n){return function(t,n){return r(t=e.call(this,t),n,this),t};function r(n,r,o,i){t.call(o,n,r),function(t,n,r){var o=e.childNodes(r,"data-tile"),i={scope:this,dataset:n,outertag:r,tiles:o};e.filterNodes(t,"[data-tag]").forEach(s,i)}.call(o,n,r,i)}function s(t){var s=t.getAttribute("data-tag"),o=s&&juse.toRef(s),i=o&&juse.filter(juse.toRef(o,".html"),this.scope);!o&&this.outertag?i=this.outertag:this.tiles[o.name]?i=this.tiles[o.name]:i&&r(i,this.dataset||n(o.value),this.scope,t),e.replaceContent(t,i)}}),this.juse("widget",["dom"],function(e){var t=["click","dblclick","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseout","mouseup","input","change","keyup","keydown","keypress"],n={enter:juse.toRef("keyup:13")};return juse.seal(function(t,n){return function(t,n){e.filterNodes(t,"[data-widget]").forEach(r,n),s(n,t)}(t=e.call(this,t),n||this),t},{bindEvent:i});function r(t){var n=juse.toRef(e.data(t,"data-widget",null)),r=juse.lookup(n,this);"function"==typeof r&&r.call(this,t),s(this,t,n)}function s(t,n,r){e.filterNodes(n,"[data-event]").forEach(o,{scope:t,base:r})}function o(t){for(var n=e.data(t,"data-event",null);n;){var r=juse.toRef(n,this.base);if(!i(this.scope,t,r)){e.data(t,"data-event",n);break}n=r.value}}function i(e,n,r,s,o){var i=juse.toRef(r);if(i){var a=u(i),c=a&&a.kind||i.kind||t[0];if(t.indexOf(c)>=0&&(s=s||juse.lookup(i,e),juse.typeOf(s,"function"))){var l={action:s,target:o,event:i},f={};return f[c]=function(e){var t=u(this.event);if(t&&t.name!=e.keyCode)return;this.target?this.action.call(null,this.target,e):this.action.call(null,e)}.bind(l),juse.follow(n,f),!0}}}function u(e){return n[e.kind]}})}),juse("juse/valid.context",["juse/text"],function(e,t){this.juse("validator",function(){return function(e){t.cacheValue("validators",this.spec.name,e)}}),this.juse("validate",function(){return function(n,r,s){var o;for(n=juse.toRef(n);n;n=juse.toRef(n.value)){var i=n.kind||n.name,u=t.cacheValue("validators",i);o=e(o,juse.typeOf(u,"function")&&u.call(this,n,r,s))}return o};function e(e,t){return t&&(e=e||[]).push(t),e}}),this.juse("required|validator",["replace"],function(e){return function(t,n,r){return n?"":e(juse.property("#required.message",this)||"required: ${0}",juse.toSpec(r))}})}),juse("juse/model.context",["juse/remote","juse/core","juse/ui","juse/valid","juse/text"],function(){var e=["kind","name"],t=this;function n(e){return juse.lookup(t.cacheValue("binders",e))||juse.lookup(t.cacheValue("binders","value"))}function r(r,s){var o=(r=juse.toRef(r))&&t.cacheValue("models",r.name);return!o&&s&&(o={tiles:[],value:null},r&&(o.spec={},t.cacheValue("models",r.name,o))),o&&s&&(juse.copy(o.spec,r,e),o.binder=n(o.spec&&o.spec.kind)),o}this.juse("binder",function(){return function(){t.cacheValue("binders",this.spec.name,this.spec)}}),this.juse("model",["dom","tile","validate","load"],function(e,s,o,i){return i.follow({load:function(){var e=t.cacheEntry("models");Object.keys(e).map(juse.valueOfKey,e).forEach(y)}}),juse.seal(function(t){return t=e.call(this,t),function(t){e.filterNodes(t,"[data-model]").forEach(u,this),a.call(this,t)}.call(this,t),t},{renderChild:function(t,n){var r=s.call(t.scope,t.content.cloneNode(!0)),o=u.call(t.scope,r);return o.nodes=e.childNodes(r),o.parentTile=t,o.value=n,g(o,n),t.node.appendChild(e.moveContent(o.nodes)),o},renderModel:g,fireEvent:function(e,t){(function(e,t){return e.spec.member?x(e,t):e.model.tiles.reduce(k,{value:t,valid:!0}).valid})(e,t)&&e.event&&(e.event.name||e.event.member)?function(e,t){var n={input:e},r=e.binder[e.event.member];juse.typeOf(r,"function")?r(e,t):juse.lookup(e.event.name,e.scope).submit(e.event,t).then(p.bind(n),m.bind(n))}(e,t):v(e,t)},notifyInput:v,addTile:d,getModel:r,getModelValue:function(e){var t=r(e=juse.toRef(e));return t.value&&e.member?t.value[e.member]:t.value},notifyModel:b,resolveEvent:p,rejectEvent:m});function u(t){var n=r(e.data(t,"data-model",null),!0);return a.call(this,t,n),n}function a(t,n){var r={scope:this,model:n};e.forNodes(t,"data-value",l,r),e.filterNodes(t).forEach(c,r),c.call(r,t)}function c(t){e.forTextNodes(t.attributes,l,this),e.forTextNodes(t.childNodes,l,this)}function l(t){var r=n(f(t,e.data(t,"data-value"),this.model&&this.model.spec));if(r){var s=e.data(t,"data-value",null),o=d.call(this.scope,t,this.model,s);r.call(this.scope,o,t,this.model)}}function f(t,n,r){return n&&juse.toRef(n,r,!0).kind||(e.textNode(t)?"text":"form"in t?"input":"")}function d(e,t,s){if(s=juse.toRef(s,t&&t.spec,!0)){var o={node:e},i=(t=(s.kind||t&&!t.spec)&&t||r(s,!0)).tiles.some(h,o)&&o.tile;return i?(i.specs=i.specs||[],i.specs.push(s)):(i={node:e,spec:s,binder:n(f(e,s)),model:t,scope:this},t.tiles.push(i)),i}}function h(e){return this.tile=e,this.node==e.node}function p(e){v(this.input,e)}function m(e){j(this.input,"event: "+juse.toSpec(this.input.event)+", message: "+e.message)}function v(e,t){e.binder.notify?e.binder.notify(e,t):e.model.linkTile?e.model.linkTile.binder.notify(e,t):b(e.model,t,e)}function j(t,n){e.toggleClass(t.node,"error",!!n),!b(r("messages"),n,t)&&n&&juse.log("error",n)}function b(e,t,n){if(function(e,t,n){if(e&&e.binder.update)return e.binder.update(e,t,n),!0}(e,t,n))return g(e,t,n),!0}function y(e){g(e,e.value)}function g(e,t,n){for(var r=!n||null===t||e.spec&&e.spec.kind?e.tiles:e.tiles.filter(T,n),s=0;s<r.length;s++)E(r[s],t,n)}function E(e,t,n){e&&e.binder.render&&e!==n&&e.binder.render(e,t,n)}function x(e,t){var n=null===t?null:o.call(e.scope,e.valid,t,e.spec);return j(e,n),!n}function k(e,t){var n=x(t,e.value);return e.valid=e.valid&&n,e}function T(e){return e.link?!!this.link:"map"==e.spec.kind||"input"!=e.spec.kind&&(this===juse.global||(this!==e&&function(e){return!this.name||!e.name||this.name===e.name}.call(this.spec,e.spec)?N.call(this.spec,e.spec)||juse.typeOf(e.specs,"array")&&e.specs.some(N,this.spec):void 0))}function N(e){return!this.member||this.member===e.member}}),this.juse("input|binder",["dom","widget","model","teval"],function(e,t,n,r){return juse.seal(function(n){n.valid=juse.toRef(e.data(n.node,"data-valid",null)),n.event=juse.toRef(e.data(n.node,"data-event",null));var r=juse.toRef(":",n.event,!0);r.kind=r.kind||function(e){switch(e.node.type){case"button":case"reset":return"click";case"checkbox":return"change";default:return"form"in e.node?"input":"click"}}(n),t.bindEvent(n.scope,n.node,r,s,n)},{render:o,clear:function(e,t){o(e,null,e),n.notifyInput(e,t)}});function s(e){n.fireEvent(e,function(e){switch(e.node.type){case"button":case"reset":return null;case"checkbox":return e.node.checked;default:return e.node.value}}(e))}function o(e,t,n){switch(t=e==n?t:r.call(e.scope,e.spec,e.model.value),e.node.type){case"button":case"reset":break;case"checkbox":e.node.checked=!!t;break;default:e.node.value=t||""}}}),this.juse("link|binder",["dom","widget","model"],function(e,t,n){return juse.seal(function(s){s.link=n.getModel(s.spec.name,!0),s.event=juse.toRef(e.data(s.node,"data-event",null)),t.bindEvent(s.scope,s.node,juse.toRef(":",s.event,!0),r,s)},{notify:function(e,t){e.model.linkTile?(n.notifyModel(e.model,t,e),n.notifyModel(e.model.linkTile.model.parentTile.model,t,e),o(e.model,e.model.linkTile,t)):e.link&&(n.notifyModel(e.link,t,e),e.model.spec?n.notifyModel(e.model,null,e):(s(e,t,e),o(e.link,e,t)))},render:s});function r(e){n.fireEvent(function(e){e.model.spec||(e.model.parentTile.model.index=e.model.parentTile.models.indexOf(e.model));return e}(e),e.link.linkTile==e?null:e.model.value)}function s(t,n,r){t.model.spec&&r?t.node.disabled=!!n:r&&(t.link.linkTile&&t.link.linkTile!=t&&e.toggleClass(t.link.linkTile.node,"selected"),e.toggleClass(t.node,"selected",!!n))}function o(e,t,n){null===n?(delete e.linkTile.model.parentTile.model.index,delete e.linkTile):e.linkTile=t}}),this.juse("list|binder",["dom","model"],function(e,t){return juse.seal(function(t){t.content=e.moveContent(t.node),t.models=[]},{update:function(e,t,n){var r=e.index;n&&r>=0?n.spec.member||(null===t?e.value.splice(r,1):e.value.splice(r,1,t)):n&&(n.model==e||n.link==e)&&t?(e.value=e.value||[],e.value.push(t)):e.value=t||null},render:function(n,r,s){var o=n.model.index;if(s&&o>=0)s.spec.member||(n.models[o].value=r),t.renderModel(n.models[o],r,s),null===r&&(e.removeContent(n.models[o].nodes),n.models.splice(o,1));else if(s&&(s.model==n.model||s.link==n.model)&&r)n.models.push(t.renderChild(n,r));else{for(o=0;o<n.models.length;o++)e.removeContent(n.models[o].nodes);if(n.models.length&&(n.models=[]),n.model.value)for(o=0;o<n.model.value.length;o++)n.models.push(t.renderChild(n,n.model.value[o]))}n.node.hidden=!n.models.length,e.toggleClass(n.node,"hidden",n.node.hidden)}})}),this.juse("map|binder",["dom","model"],function(e,t){return juse.seal(function(t){t.content=e.moveContent(t.node),t.models=[]},{update:function(e,t,n){var r=n&&n.spec.name+"#"+n.spec.member;e.value=e.value||{},r&&(t?e.value[r]=t:delete e.value[r])},render:function(n,r,s){var o=s&&s.spec.name+"#"+s.spec.member,i=o&&n.models[o];if(r)o&&!i?n.models.push(n.models[o]=t.renderChild(n,r)):i&&(i.value=r,t.renderModel(i,r));else if(i){var u=n.models.indexOf(i);e.removeContent(n.models[u].nodes),n.models.splice(u,1),delete n.models[o]}n.node.hidden=!n.models.length,e.toggleClass(n.node,"hidden",n.node.hidden)}})}),this.juse("remote|binder",["dom","widget","model","request"],function(e,t,n,r){return juse.seal(function(n){n.event=juse.toRef(e.data(n.node,"data-event",null)),t.bindEvent(n.scope,n.node,juse.toRef(":",n.event,!0),s,n),o(n)},{notify:function(e,t){n.notifyModel(n.getModel(e.spec),t,e)},load:o});function s(e){n.fireEvent(e,e.model.value)}function o(e){var t={input:e};r.call(e.scope,juse.toRef(".json",e.spec,!0)).then(n.resolveEvent.bind(t),n.rejectEvent.bind(t))}}),this.juse("text|binder",["model","teval"],function(e,t){var n=/%\{([^\}]*)\}/g;return juse.seal(function(t,r,s){var o=this;r.nodeValue=r.nodeValue.replace(n,function(t,n){var i=e.addTile.call(o,r,s,n);return i&&(i.content=r.nodeValue),""})},{render:function(r,s,o){r.node.nodeValue=r.content.replace(n,function(n,s){var o=(s=juse.toRef(s,r.model.spec,!0)).name?e.getModelValue(s.name):r.model.value;return t.call(r.scope,s,o)||""})}})}),this.juse("value|binder",["dom","teval"],function(e,t){return juse.seal(function(e){e.length=e.node.innerHTML.length},{update:function(e,t,n){n&&n.spec.member?(e.value=e.value||{},e.value[n.spec.member]=t):e.value=t},render:function(n,r,s){var r=t.call(n.scope,n.spec,n.model.value);n.length?n.node.hidden="hidden"==r:(n.node.hidden=!r,n.node.innerHTML=r||"");e.toggleClass(n.node,"hidden",n.node.hidden)}})})});