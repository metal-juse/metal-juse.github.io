!function(){var e=["spec","refs","value"],t=["kind","context"],n=["context"],r=["key","kind","name","type","member","context","pipe","value"],o=[""].concat(r),i=/(?:\s*([^.#@|;\s]*)\s*=)?(?:\s*([^.#@|;\s]*)\s*:)?\s*([^.#@|;]*)(?:\.([^#@|;\s]*))?(?:#([^@|;\s]*))?(?:@([^|;\s]*))?(?:\s*\|\s*([^;\s]*))?(?:\s*;\s*([\S\s]*))?/,s=["=",":","",".","#","@","|",";"],u=["","name","value"],a=/function\s*([\S]*?)\s*\([^)]*\)\s*{\s*(?:\/\*\*+\s*([\S\s]*?)\s*\*\*+\/)?/,c=/^[\s*]*@([^\s]+)[ \f\r\t\v]*([^\n]*\S)?\s*/,l=ae(["BUFFER","LOAD","DEFINE","RESOLVE","READY","FLUSH","DONE","ERROR"]),f=ae(["error","warn","info","debug"]),d={buffer:[],flushCount:0,moduleCount:0,global:this.document?this:this.global||this};return function(){d.global.juse||(d.global.juse=m,d.global.define=d.global.define||m,d.doc=d.global.document,d.doc?(d.async=!!d.doc.currentScript,d.script=ee(),d.jusePath=ue(d.script.getAttribute("src"),-1),d.app=ie(d.script.getAttribute("data-app")||""),d.doc.head!=d.script.parentNode&&d.doc.head.appendChild(d.script)):(d.jusePath=__dirname,d.app=ie(process.argv[2]||"")),ye("--boot--"),m(".context",function(){function e(e,t){return S(e,k(t&&t.spec||ne()))}function t(t,n){var r=t&&ie({},t);if(r)return r.name?me(function(e){return me(k(e),["value"])}(e(r,n)),[r.member]):n.context.property(ie(r,n.spec))||n.meta[r.member]}function n(t,n,r){var o=ie(t);if(o){var i=k(n&&n.spec||ne());return r=void 0!==r?V(me(r=V(r,o,"type",i),[o.member]),o,"pipe",i):D.call(i,e(o,n))}}function r(e,t){var n=(e=ie(e)).kind?this.cacheValue("properties",e.kind,{}):this.cacheEntry("properties"),r=n[e.name]=n[e.name]||(e.member?{}:t);return e.member&&(r=r[e.member]=r[e.member]||t),r}this.juse(function(){return ce(this.context.juse,{global:d.global,toRef:ie,toPath:oe,toSpec:se,slicePath:ue,resolve:e,lookup:t,filter:n,memberName:ve,memberValue:me,typeOf:de,valueOfKey:he,copyTo:le,seal:ce})}),this.juse("juse/cache",function(){return le(this,{init:e}),ce(function(e){le(k(this.spec).cache,e)},{init:e});function e(){k(this.spec).cache={},le(this,{cacheEntry:n,cacheValue:t})}function t(e,t,n){var r=this.cacheEntry(e);return void 0!==n&&(r[t]=r[t]||n),r[t]}function n(e,t){var n=k(this.spec).cache;return n[e]=n[e]||t||{}}}),this.juse("juse/context",["cache"],function(e){return le(this,{init:t}),t.call(this.context),e.call(this.context,n({map:{"*":"modules:",context:this.spec},roots:["juse","jx"]})),function(t){return le(this.cacheEntry("properties"),me(t,"properties")),e.call(this,n(t)),{}};function t(){e.init.call(this),le(this,{replace:s,property:r})}function n(e){return e&&e.map&&o(e.map),e&&e.remap&&Object.keys(e.remap).map(he,e.remap).forEach(o),e}function o(e){e&&le(e,Object.keys(e).map(he,e).map(ie),Object.keys(e),!0,!0)}}),this.juse("juse/contextAware",function(){return function(){le(this,{getContextScope:b})}});var o=/\$\{([^\}]+)\}/g,i=/\$\{([^\}]+)\}/;function s(e,t){var n=this;return e&&"string"==typeof e&&i.test(e)?e.replace(o,function(e,r){return n.property(ie(r,t))||e}):e}}),d.doc?(d.global.addEventListener("load",p),d.global.addEventListener("hashchange",p)):p())};function h(){d.doc?ye(d):ye(d.jusePath,d.app),ye("--done--")}function p(){b().juse(d.doc?["juse/ui","juse/core"]:["juse/core"],function(){b().juse(["map@juse/core"],function(e){var t=ie(te(),ne());le(b().cacheEntry("properties"),e(t.value)),function(){var e=ie(te(),ne()),t=ie(e.context||"");delete e.value,e.context=t.name||e.context||"",d.appPath=t.kind||ie(d.app.context||"").kind,b().juse([ie(e.context,".context")],function(){b().juse([e,"load@juse/core","done@juse/core"],function(t,n,r){ne(e);var o=de(t,"function")?t():t;n.fire(o),r.fire(e)||setTimeout(h)})})}()})})}function m(t,n,r){var o=v(d.doc?ie(Z(ee())):d.currentSpec,function(t,n){n<e.length&&(de(t[0],"array")?t.unshift(""):n<2?t.unshift("",null):de(t[1],"array")||t.splice(1,0,null));return le({},t,e)}([t,n,r],arguments.length),this),i=k(o);i&&function(e){return e.flushState==l.ERROR}(i)&&N(o),i&&!F(i)||(ye("define:",se(o)),i=j(o,l.DEFINE),d.context=d.context||i,this!=d.global&&1!=d.buffer.length||M())}function v(e,t,n){var o=n?{meta:{},args:t,refs:[]}:{args:{},spec:e};return n&&(o.spec=ie(o.args.spec,e),o.value_=function(e,t){var n=de(t,"function")&&a.exec(d.global.juse.toString.call(t));le(e,n,u),t=e.value,delete e.value;for(;n=c.exec(t);){var r=n[1],o=n[2]||"";e[r]?(de(e[r],"array")||(e[r]=[e[r]]),e[r].push(o)):e[r]=o,t=t.substring(n.index+n[0].length)}return t}(o.meta,o.args.value)),n&&d.context?n!=d.global?(o.spec=ie(o.args.spec,{name:o.meta.name,context:n.spec.name}),le(o,{name:o.spec.name,context:o.spec.context})):(le(o,e),le(o,C(o,o,!0),r,!0,!0),le(o,{name:o.spec.name||o.meta.name,type:"context"==o.spec.type&&"context"})):le(o,o.spec),o}function j(e,t){var n=k(e)||{};if(le(n,e,r,!0,!0),n.def=e,n.flushState=t,!k(e)){if(n.id=d.moduleCount++,!N(e,n))return;d.buffer.push(n)}return n}function y(e,t){var n=de(e,"object")?e.context||t:e;return n?me(d.context,["modules",n]):d.context}function b(e){return y(ie(e)).scope}function g(e){var t={ref:e};return k(e)||d.buffer.some(E,t)&&t.module}function E(e){return this.module=e,Object.keys(this.ref).every(x,this)}function x(e){return this.ref[e]===this.module[e]}function k(e,t,n,r){return"context"==e.type?y(e.name):de(T(e),"string")&&me(y(e,r),["modules",T(e)])}function T(e,t){var n=de(e,"object")?e.name:e;return(t=e.type&&"context"!=e.type&&"js"!=e.type?e.type:t)?[n,t].join("."):n}function N(e,t){if(e.name){var n=y(e);if(n)n.modules[T(e)]=t;else if(e.context)return void ye("warn","undefined context:",e.context)}return t}function O(e){var t=S(e,this);return t.value&&(t.value=b(this).replace(t.value,this)),t}function R(e){return S(e,this,!0)}function S(e,o,i){var s=ie({},e);if(!s.name||!o)return s;var u=!i&&k(s,0,0,o.context),a=C(s,o,!0);if(a||!u||u==o){if(a=a||C(s,o),i&&!a)return;le(s,a,r,!0,!0),a||(s.name=function(e,t){return["context"in e||e.name.indexOf("/")>=0?null:ue(t.name,-1)].concat(e.name.split("/")).filter(me).join("/")}(s,o))}return s.type&&s.type!=o.type&&le(s,C(T("*",s.type),o)),le(s,o,s.type==o.type?t:n),le(s,y(o),t),(s.context||"context"==o.type||re(s.name))&&le(s,C("*",o)),s}function C(e,t,n){var r=de(e,"object")?T(e,e.type):e,o=T(t,t.type),i=me(y(d.app),["cache","remap",o,r])||me(y(t),["cache","remap",o,r]);return n?i:i||me(y(d.app),["cache","map",r])||me(y(t),["cache","map",r])||me(y(),["cache","map",r])||t.name&&function(e,t){var n={refKey:t};return y(e).refs.some(w,n)&&n.value}(t,r)}function w(e){return this.value=me(k(e),["cache","map",this.refKey])}function D(e){var t=e&&k(e);if(t){var n=V(t.value,t.def.spec,"pipe",t);return e.member&&e.member!=t.member&&(n=me(n,[e.member])),V(n,e,"pipe",this)}}function A(e,t,n){var r="type"==t?".":"|",o="type"==t?R:O;return e&&e[t]?e[t].split(r).map(o,n).filter(me):[]}function V(e,t,n,r,o){return A(t,n,r).map(k).reduce(L,{scope:r.scope,value:e,kind:ie(o)}).value}function L(e,t){return t=e.kind?me(t,[e.kind.name,e.kind.member]):me(t,"value"),e.value=de(t,"function")&&t.call(e.scope,e.value)||e.value,e}function M(){clearTimeout(d.flushTimeout),d.buffer.filter(q).filter(Y).forEach($),d.buffer.some(H)||d.buffer.filter(Y).forEach($),d.buffer.some(F)||d.buffer.forEach(Q),!d.async&&d.buffer.some(I)||d.buffer.some(G),d.flushCount>d.moduleCount?(ye(d),ye("--timeout--")):d.buffer.some(I)?(d.flushCount++,d.flushTimeout=setTimeout(J,1e3)):(d.buffer=d.buffer.filter(U),d.buffer.length&&!d.buffer.some(I)?(d.flushCount++,M()):d.buffer.length||(d.flushCount=0))}function F(e){return e.flushState<l.DEFINE}function I(e){return e.flushState==l.LOAD}function _(e){return e.flushState>=l.READY}function U(e){return e.flushState<l.DONE}function B(e){return e.flushState>=l.FLUSH}function q(e){return"context"==e.type}function H(e){return q(e)&&(e.flushState==l.READY||e.flushState==l.FLUSH)}function P(e){return B(e)&&(!e.modules||Object.keys(e.modules).map(he,e.modules).every(B))}function Y(e){if(e.flushState==l.DEFINE||e.flushState==l.RESOLVE)return e.flushState=l.RESOLVE,e.refs=[],e.def.args.refs&&(e.def.refs=e.def.args.refs.map(O,e),e.refs.push.apply(e.refs,e.def.refs.filter(me)),e.def.refs.forEach(X,e)),e.refs.push.apply(e.refs,A(e.def.spec,"type",e)),X.call(e,e.def.spec),!0}function X(e){this.refs.push.apply(this.refs,A(e,"pipe",this))}function $(e){if(e.flushState==l.RESOLVE){if(!e.refs.every(k)&&!y(e).refs.map(k).every(P))return;e.flushState=l.READY,e.refs.forEach(K,e),de(e.value,"string")&&e.value&&!pe(e)&&(e.flushState=l.BUFFER)}}function K(e){e&&!k(e)&&(ye("buffer:",se(e),"by",se(this)),pe(e)?j(v(e),l.DEFINE):j(v(e),l.BUFFER)||ye("warn","fail to buffer",se(e),"by",se(this)))}function G(e){if(e.flushState==l.BUFFER&&(e.flushState=l.LOAD,function(e){if(!d.doc){var t=oe(e);ye("load:",se(e),"<-",t),d.currentSpec=e,require(t);var n=k(e);return pe(n)&&(n.flushState=l.DEFINE),!0}if(!function(e){var t=d.script,n=se(e);for(;t=t.previousElementSibling;)if(Z(t)==n)return t}(e)){var r=function(e){var t=se(e),n=oe(e),r="css"==e.type?"link":"script",o=d.doc.createElement(r);o.setAttribute("data-spec",t),"link"==r?(o.rel="stylesheet",o.href=n,n=o.href):(o.async=d.async,o.src=n,n=o.src);return ye("load:",t,"<-",n),o}(e);return r.addEventListener("load",W),r.addEventListener("error",W),d.script.parentNode.insertBefore(r,d.script),!0}}(e.def)))return!d.async}function z(e,t,n,r){(r||F(e))&&(e.flushState=l.ERROR,e.value=r||Error("timeout error"),ye("error",se(e.def),e.value.message))}function J(){d.buffer.forEach(z),M()}function Q(e){if(e.flushState==l.READY||e.flushState==l.FLUSH){var t=e.refs.map(g).filter(me);if(e.flushState==l.READY){if(!t.every(_))return;e.flushState=l.FLUSH,t.forEach(Q)}if(e.flushState==l.DONE)return;if(!t.every(B))return;if(!y(e).refs.map(k).every(P))return;try{!function(e){ye("init:",se(e.def)),"context"==e.type&&(e.modules={});(function(e){e.scope={spec:le({},e.def,r),meta:le({},e.def.meta),log:ye},e.scope.context=b(e),"context"==e.type?e.scope.define=e.scope.juse=m:e.name&&e.scope.context.cacheValue&&e.scope.context.cacheValue("map",ue(e.name,-1,1),e.scope.spec);V(e.value,e.def.spec,"type",e,"scope#init")})(e),function(e){if(e.value=(de(e.def.args.value,"function")?e.def.value_:e.def.args.value)||pe(e),de(e.def.args.value,"function")){var t=e.def.refs.map(D,e);t.push(e.scope),e.scope.value=e.value,e.value=e.def.args.value.apply(e.scope,t)||e.value,delete e.scope.value}e.value=V(e.value,e.def.spec,"type",e)}(e)}(e),e.flushState=l.DONE}catch(t){z(e,0,0,t)}}}function W(e){var t=g(ie(Z(e.target)));F(t)&&("load"==e.type?"css"==t.type?(t.refs=[],t.flushState=l.DONE):pe(t)&&(t.flushState=l.DEFINE):z(t,0,0,Error("response "+e.type)),M())}function Z(e){return e.getAttribute("data-spec")}function ee(){var e;return d.doc.currentScript||d.script&&d.script.previousElementSibling||(e=d.doc.getElementsByTagName("script"))[e.length-1]}function te(){return d.doc?d.global.location.hash.substring(1):""}function ne(e){return d.currentApp=e||d.currentApp,d.currentApp||d.app}function re(e){return!d.context.cache||d.context.cache.roots.indexOf(e.split("/")[0])>=0}function oe(e){var t=ie(e),n=t.value;if(!n){var r=y(t),o=T(t,"js");n=[re(o=r.kind?[r.name,o].join("/"):o)||d.doc?"":".",n=re(o)?d.jusePath:d.appPath,t.kind,o].filter(me).join("/")}return n}function ie(e,t,n){return de(e,"string")&&(e=le({},i.exec(e),o)),de(t,"string")&&(t=le({},i.exec(t),o)),de(t,"object")||(t=null),(e=le(e,t,n=de(n,"array")&&n||n&&e&&Object.keys(e)||r,!0))&&e.name&&(e.name=e.name.trim()),e}function se(e){for(var t=[],n=0;n<r.length;n++){var o=e[r[n]],i=s[n];(o||"string"==typeof o&&i)&&(n>1?t.push(i,o):t.push(o,i))}return t.join("")}function ue(e,t,n,r){if(!e)return e;t=t||0,r=r||"/";var o=e.split(r),i=(n=arguments.length>2?n:t<0?t:o.length-t)>0;n=n>0?n:-n;var s=o.splice(t,n);return(i?s:o).join(r)}function ae(e){for(var t=0;t<e.length;t++)e[e[t]]=t;return ce(e)}function ce(e){for(var t=1;t<arguments.length;t++)n=e,r=arguments[t],void 0,(o=de(r,"function")&&a.exec(d.global.juse.toString.call(r))[1])?n[o]=r:le(n,r);var n,r,o;return Object.freeze(e)}function le(e,t,n,r,o){if(!e||!t)return e;if(de(t,["array","arguments"])&&n)for(var i=0;i<t.length;i++){fe(e,u=n[i],t[i],n,r,o)}else{var s=Object.keys(t);for(i=0;i<s.length;i++){var u;fe(e,u=s[i],t[u],n,r,o)}}return e}function fe(e,t,n,r,o,i){t&&(r&&r.indexOf(t)<0||(n||"string"==typeof n)&&(e.propertyIsEnumerable(t)&&!o||e[t]&&!n||e[t]&&!i||(e[t]=n)))}function de(e,t,n){var r=typeof e;return"object"==r&&(r=(r=d.toString.call(e)).substring(8,r.length-1).toLowerCase()),t?n?0==r.indexOf(t):d.buffer.constructor===t.constructor?t.indexOf(r)>=0:t==r:r}function he(e){return this[e]}function pe(e){return d.doc&&d.doc.getElementById(e.member||e.name)||me(d.global,e.member||e.name)}function me(e,t){return je(e,t)}function ve(e,t){return je(e,t,!0)}function je(e,t,n){var r;if(t=de(t,"string")?t.split("."):t)for(var o=0;o<t.length&&(de(r=t[o],"string")&&e);o++)e=!de(e,"string")&&r in e?e[r]:r=null;return n?de(r,"string")&&r:e}function ye(e){if("undefined"!=typeof console&&(me(y(),["scope","property"])&&"dev"==b().property("app-mode")))if("string"==typeof e){var t=f.indexOf(e);(t<0?console.log:console[f[t]]).apply(console,arguments)}else console.dir(e)}}()(),juse("juse/resource.context",function(){this.juse("properties",function(){return function(e){if(juse.memberName(e,"kind")){var t=e.kind||juse.slicePath(this.spec.name,-1,1);juse.copyTo(this.context.cacheValue("properties",t,{}),e)}else juse.copyTo(this.context.cacheEntry("properties"),e)}}),this.juse("json",function(){return function(e){return JSON.parse(e)}}),this.juse("html",function(){return function(e,t){if(juse.typeOf(e,"html",!0))return e;var n=juse.global.document.createElement(t||"div");return n.innerHTML=e,n}})}),juse("juse/run.context",function(){this.juse("try",function(){return function(e,t,n,r){try{return e.apply(r,t)}catch(e){return n&&(n.ex=e),n}}}),this.juse("async",["try"],function(e,t){var n="function"==typeof setImmediate?setImmediate:setTimeout,r=[];return function(e){r.length||n(o),r.push(e)};function o(){for(var n={};r.length;)e(r.shift(),null,n)===n&&t.log("error",n.ex)}}),this.juse("promise",["try","async"],function(e,t){var n,r={};return juse.seal(o,{resolve:function(e){return o(function(t,n){t(e)})},reject:function(e){return o(function(t,n){n(e)})}});function o(t){if("function"!=typeof t)throw TypeError("not a function: "+t);var n=s();return e(c,[n,t],r)===r&&d(n,"rejected",r.ex),n.handle}function i(e,t){return e&&e[t]}function s(e,t,r){var o={depth:0};return o.handle=new function(e,t){this.then=e,this.catch=t}(u.bind(o),u.bind(o,null)),e&&(e.children=e.children||[],e.children.push(o),o.fulfilled=t,o.rejected=r),n&&(n.inner=o,o.outer=n),o}function u(e,t){var n=s(this,e,t);return f.call(this,n),n.handle}function a(e,t,n){this.depth>=e||this.state||(this.depth=e,d(this,t,n)&&l(this))}function c(e,t,n){t.call(n,a.bind(e,e.depth+1,"fulfilled"),a.bind(e,e.depth+1,"rejected"))}function l(e){e.state&&(e.children?e.children.forEach(f,e):e.outer&&f.call(e,e.outer))}function f(o){var i=this;i.state&&!o.state&&t(function(){(function(t,o){if(!o.state||t.state)return;var i=o.state,s=o.value;"function"==typeof t[i]&&(n=t,(s=e(t[i],[s],r))!==r?i="fulfilled":(s=r.ex,i="rejected"),n=null);return d(t,i,s)})(o,i)&&l(o)})}function d(t,n,o){if(t.handle===o)o=TypeError("cyclic promise"),n="rejected";else if(t.inner&&t.inner.handle===o)for(var s=t.inner;s;){if(s.state){n=s.state,o=s.value;break}s=s.inner}var u=e(i,[o,"then"],r);if(u===r&&(o=r.ex,n="rejected"),"function"==typeof u&&("object"==typeof o||"function"==typeof o)&&"fulfilled"==n){var a=t.depth;if(e(c,[t,u,o],r)!==r||a<t.depth)return!1;o=r.ex,n="rejected"}return t.state=n,t.value=o,!0}})}),juse("juse/remote.context",["run"],function(){function e(e){this.xhr.setRequestHeader(e,this.args.headers[e])}function t(e){return juse.typeOf(e,"object")?Object.keys(e).map(n,e).join("&"):e}function n(e){return[encodeURIComponent(e),encodeURIComponent(this[e])].join("=")}this.juse("request",["promise"],function(n){return function(r,o){var i={spec:r,url:juse.toPath(juse.resolve(r,this)),args:o||{},scope:this};return n(function(n,r){try{(function(n,r){this.xhr=new XMLHttpRequest;var o=(this.args.method||"GET").toUpperCase();switch(o){case"GET":this.data=null,this.xhr.open(o,[this.url,t(this.args.data)].filter(juse.memberValue).join("?"),!0);break;case"POST":this.data=t(this.args.data),this.xhr.open(o,this.url,!0),this.xhr.setRequestHeader("Content-Length",this.data.length),this.xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");break;default:throw Error("method not supported: "+o)}this.xhr.onreadystatechange=function(e,t){if(4==this.xhr.readyState){if(200==this.xhr.status||0==this.xhr.status&&this.xhr.responseText)try{this.value=juse.filter(this.spec,this.scope,this.xhr.responseText)}catch(e){this.error=e}else this.error=Error(this.xhr.statusText||"Not Found"),this.error.code=this.xhr.status||404;this.error?t.call(this.scope,this.error):e.call(this.scope,this.value)}}.bind(this,n,r),this.args.headers&&Object.keys(this.args.headers).forEach(e,this);return this.xhr}).call(this,n,r).send(this.data)}catch(e){r.call(this.scope,e)}}.bind(i))}})}),juse("juse/core.context",["juse/run"],function(){this.juse("map",function(){return function(e){for(var t={},n=juse.toRef(e);n&&n.name;n=juse.toRef(n.value))t[n.key||""]=n.name;return t}}),this.juse("event",["follower"],function(e){return juse.copyTo(this,{init:function(){juse.copyTo(this,{fire:t})}}),function(){};function t(t){return e.notify(this.spec,t)}}),this.juse("load.event",function(){return juse.seal(function(){},{fire:this.fire.bind(this)})}),this.juse("done.event",function(){return juse.seal(function(){},{fire:this.fire.bind(this)})}),this.juse("follower.contextAware",function(e){return juse.seal(function(){(function(e){juse.typeOf(e,"array")?e.forEach(n,this):juse.typeOf(e,"string")&&n.call(this,e)}).call(this,this.meta.follow)},{notify:function(e,n,o){var i={event:juse.toRef(e),value:n,error:o};return t(i.event).forEach(r,i),i.result}});function t(t){return e.getContextScope(t).cacheValue("followers",t.name,[])}function n(e){var n=juse.toRef(e||this.spec);t(n).push(juse.toRef(n.value||"#follow",this.spec))}function r(t){var n=juse.lookup(t);if(juse.typeOf(n,"function"))try{this.result=this.result||n(this.event,this.value,this.error)}catch(t){e.log("error",t)}}}),this.juse("provider.contextAware",["promise","follower"],function(e,t,n){return juse.seal(function(){(function(e){juse.typeOf(e,"array")?e.forEach(r,this):juse.typeOf(e,"string")&&r.call(this,e)}).call(this,this.meta.provide)},{fire:function(r,i){var s=juse.toRef(r),u=juse.lookup(n.getContextScope(s).cacheValue("providers",s.name)),a={event:s,value:i};return juse.typeOf(u,"function")?e(u.bind(a)).then(function(n){return t.notify(this.event,n),e.resolve(n)}.bind(a),o.bind(a)):e.reject(Error("provider not found for: "+juse.toSpec(s))).then(null,o.bind(a))}});function r(e){var t=juse.toRef(e||this.spec);n.getContextScope(t).cacheValue("providers",t.name,juse.toRef(t.value||"",this.spec))}function o(n){return t.notify(this.event,null,n),e.reject(n)}})}),juse("juse/text.context",["juse/core"],function(){this.juse("replace",["teval"],function(e,t){var n=/\$\{([^\}]+)\}/g,r=/\$\{([^\}]+)\}/;return function(o,i){e=e||juse.lookup("teval",t);var s=this,u=arguments;return o&&"string"==typeof o&&r.test(o)?o.replace(n,function(t,n){var r=t,o=parseInt(n)+1;return o?o in u&&(r=u[o]):r=e.call(s,n,i)||r,r}):o}}),this.juse("teval",["replace","map"],function(e,t,n){return function(n,r){var o=juse.toRef(n),i=this.context.property(o)||juse.filter(o,this,r);i=void 0===r?i||juse.lookup(o,this):i;var s=juse.filter(o.value,this)||t(o.value);if(s){i=juse.typeOf(i,"array")&&!i.length||juse.typeOf(i,"object")&&!Object.keys(i).length?null:i;var u=juse.memberName(s,[i])?juse.memberValue(s,[i]):i&&"*"in s?s["*"]:!i&&""in s?s[""]:i;u!==i&&(i=e.call(this,u,i))}return i}})}),juse("juse/ui.context",["juse/resource","juse/text","juse/core"],function(){var e,t,n=[];this.juse("view.follower",["html"],function(n,r){return this.meta.follow="load@juse/core",juse.seal(function(){r.context.cacheValue("views",this.spec.name,this.spec)},{follow:function(r,o){e=e||juse.global.document.body.querySelector("[data-view]")||juse.global.document.body,o=n(o),t.closest(o,e)||(e.lastElementChild?e.replaceChild(o,e.lastElementChild):e.appendChild(o))}})}),this.juse("dom",["html"],function(e){return t=juse.seal(function(t,n){return juse.typeOf(t,"string")?e.call(this,t):n?t.cloneNode(!0):t},{TEXT_NODE:juse.global.document.TEXT_NODE,ELEMENT_NODE:juse.global.document.ELEMENT_NODE,ATTRIBUTE_NODE:juse.global.document.ATTRIBUTE_NODE,moveContent:r,replaceContent:function(e,t){e&&e.parentNode&&t&&(r(t,e),e.parentNode.removeChild(e))},removeContent:function(e){if(juse.typeOf(e,"array"))e.forEach(i);else for(;e.firstChild;)i(e.firstChild)},childNodes:function(e,t){return t?e?s(e.childNodes,{name:t,nodes:{}}).nodes:{}:n.slice.call(e.childNodes)},forNodes:function(e,t,n,r){r={name:t,nodes:[e.childNodes],callback:n,scope:r};for(var o=0;o<r.nodes.length;o++)s(r.nodes[o],r)},closest:function(e,t){for(var r={selectors:t},o=e.parentNode;o;o=o.parentNode)if(e=n.some.call(o.childNodes,a,r)&&r.node)return e},filterNodes:function(e,r){var o=(r=r||e.nodeType!=t.ELEMENT_NODE&&"*")?e.querySelectorAll(r):e.getElementsByTagName("*");return n.slice.call(o)},data:function(e,n,r){if(e.nodeType==t.ELEMENT_NODE){var o=e.getAttribute(n);return null===r?e.removeAttribute(n):void 0!==r&&e.setAttribute(n,r),o}},textNode:c,forTextNodes:function(e,t,r){e&&n.filter.call(e,c).forEach(t,r)},toggleClass:function(e,t,n){var r=e.className?e.className.split(" "):[],o=r.indexOf(t);n&&o<0?r.push(t):!n&&o>=0&&r.splice(o,1);t=r.join(" "),e.className!=t&&(e.className=t)}});function r(e,t){if(t="string"==typeof(t=t||juse.global.document.createDocumentFragment())?juse.global.document.createElement(t):t,juse.typeOf(e,"array"))e.forEach(o,t);else for(;e.firstChild;)o.call(t,e.firstChild);return t}function o(e){this.parentNode?this.parentNode.insertBefore(e,this):this.insertBefore(e,null)}function i(e){e.parentNode&&e.parentNode.removeChild(e)}function s(e,t){return n.reduce.call(e,u,t)}function u(e,n){return n.nodeType==t.ELEMENT_NODE&&(e.callback?(e.name&&!n.hasAttribute(e.name)||e.callback.call(e.scope,n),e.nodes.push(n.childNodes)):n.hasAttribute(e.name)&&(e.nodes[n.getAttribute(e.name)]=n)),e}function a(e){if(e.nodeType==t.ELEMENT_NODE){var n="string"!=typeof this.selectors?e===this.selectors:e.matches?e.matches(this.selectors):e.parentNode.querySelector(this.selectors)==e;return this.node=n&&e}}function c(e){return e.nodeType==t.ATTRIBUTE_NODE||e.nodeType==t.TEXT_NODE}}),this.juse("replace",["dom","replace@juse/text"],function(e,t){return function(t,n){var o={scope:this,dataset:n};return e.filterNodes(t).forEach(r,o),r.call(o,t),t};function r(t){t.nodeType==e.ELEMENT_NODE&&(n.forEach.call(t.attributes,o,this),n.forEach.call(t.childNodes,o,this))}function o(n){n.nodeType!=e.ATTRIBUTE_NODE&&n.nodeType!=e.TEXT_NODE||(n.nodeValue=t.call(this.scope,n.nodeValue,this.dataset))}}),this.juse("tile",["dom","replace","map"],function(e,t,n){return function(t,n){return r(t=e.call(this,t),n,this),t};function r(n,r,i,s){t.call(i,n,r),function(t,n,r){var i=e.childNodes(r,"data-tile"),s={scope:this,dataset:n,outertag:r,tiles:i};e.filterNodes(t,"[data-tag]").forEach(o,s)}.call(i,n,r,s)}function o(t){var o=t.getAttribute("data-tag"),i=o&&juse.toRef(o),s=i&&juse.filter(juse.toRef(i,".html"),this.scope);!i&&this.outertag?s=this.outertag:this.tiles[i.name]?s=this.tiles[i.name]:s&&r(s,this.dataset||n(i.value),this.scope,t),e.replaceContent(t,s)}}),this.juse("widget",["dom"],function(e){var t=["click","dblclick","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseout","mouseup","input","change","keyup","keydown","keypress"],n={enter:juse.toRef("keyup:13")};return juse.seal(function(t,n){return function(t,n){e.filterNodes(t,"[data-widget]").forEach(r,n),o(n,t)}(t=e.call(this,t),n||this),t},{bindEvent:s});function r(t){var n=juse.toRef(e.data(t,"data-widget",null)),r=juse.lookup(n,this);"function"==typeof r&&r.call(this,t),o(this,t,n)}function o(t,n,r){e.filterNodes(n,"[data-event]").forEach(i,{scope:t,base:r})}function i(t){for(var n=e.data(t,"data-event",null);n;){var r=juse.toRef(n,this.base);if(!s(this.scope,t,r)){e.data(t,"data-event",n);break}n=r.value}}function s(e,n,r,o,i){var s=juse.toRef(r);if(s){var a=u(s),c=a&&a.kind||s.kind||t[0];if(t.indexOf(c)>=0&&(o=o||juse.lookup(s,e),juse.typeOf(o,"function"))){var l={action:o,target:i,event:s};return n.addEventListener(c,function(e){var t=u(this.event);if(t&&t.name!=e.keyCode)return;this.target?this.action.call(null,this.target,e):this.action.call(null,e)}.bind(l)),!0}}}function u(e){return n[e.kind]}})}),juse("juse/valid.context",["juse/text"],function(e,t){this.juse("validator",function(){return function(e){t.cacheValue("validators",this.spec.name,e)}}),this.juse("validate",function(){return function(n,r,o){var i;for(n=juse.toRef(n);n;n=juse.toRef(n.value)){var s=n.kind||n.name,u=t.cacheValue("validators",s);i=e(i,juse.typeOf(u,"function")&&u.call(this,n,r,o))}return i};function e(e,t){return t&&(e=e||[]).push(t),e}}),this.juse("required.validator",["replace"],function(e){return function(t,n,r){return n?"":e(juse.lookup("#required.message",this)||"required: ${0}",juse.toSpec(r))}})}),juse("juse/model.context",["juse/remote","juse/core","juse/ui","juse/valid","juse/text"],function(){var e=["kind","name"],t=this;function n(e){return juse.lookup(t.cacheValue("binders",e))||juse.lookup(t.cacheValue("binders","value"))}function r(r,o){var i=(r=juse.toRef(r))&&t.cacheValue("models",r.name);return!i&&o&&(i={tiles:[],value:null},r&&(i.spec={},t.cacheValue("models",r.name,i))),i&&o&&(juse.copyTo(i.spec,r,e),i.binder=n(i.spec&&i.spec.kind)),i}this.juse("binder",function(){return function(){t.cacheValue("binders",this.spec.name,this.spec)}}),this.juse("model.follower",["dom","tile","provider","validate"],function(e,o,i,s,u){return this.meta.follow="load@juse/core",juse.seal(function(t){return t=e.call(this,t),function(t){e.filterNodes(t,"[data-model]").forEach(a,this),c.call(this,t)}.call(this,t),t},{follow:function(){var e=t.cacheEntry("models");Object.keys(e).map(juse.valueOfKey,e).forEach(g)},renderChild:function(t,n){var r=o.call(t.scope,t.content.cloneNode(!0)),i=a.call(t.scope,r);return i.nodes=e.childNodes(r),i.parentTile=t,i.value=n,E(i,n),t.node.appendChild(e.moveContent(i.nodes)),i},renderModel:E,fireEvent:function(e,t){(function(e,t){return e.spec.member?k(e,t):e.model.tiles.reduce(T,{value:t,valid:!0}).valid})(e,t)&&e.event&&(e.event.name||e.event.member)?function(e,t){var n={input:e},r=e.binder[e.event.member];juse.typeOf(r,"function")?r(e,t):i.fire(e.event,t).then(m.bind(n),v.bind(n))}(e,t):j(e,t)},notifyInput:j,addTile:h,getModel:r,getModelValue:function(e){var t=r(e=juse.toRef(e));return t.value&&e.member?t.value[e.member]:t.value},notifyModel:b,resolveEvent:m,rejectEvent:v});function a(t){var n=r(e.data(t,"data-model",null),!0);return c.call(this,t,n),n}function c(t,n){var r={scope:this,model:n};e.forNodes(t,"data-value",f,r),e.filterNodes(t).forEach(l,r),l.call(r,t)}function l(t){e.forTextNodes(t.attributes,f,this),e.forTextNodes(t.childNodes,f,this)}function f(t){var r=n(d(t,e.data(t,"data-value"),this.model&&this.model.spec));if(r){var o=e.data(t,"data-value",null),i=h.call(this.scope,t,this.model,o);r.call(this.scope,i,t,this.model)}}function d(t,n,r){return n&&juse.toRef(n,r,!0).kind||(e.textNode(t)?"text":"form"in t?"input":"")}function h(e,t,o){if(o=juse.toRef(o,t&&t.spec,!0)){var i={node:e},s=(t=(o.kind||t&&!t.spec)&&t||r(o,!0)).tiles.some(p,i)&&i.tile;return s?(s.specs=s.specs||[],s.specs.push(o)):(s={node:e,spec:o,binder:n(d(e,o)),model:t,scope:this},t.tiles.push(s)),s}}function p(e){return this.tile=e,this.node==e.node}function m(e){j(this.input,e)}function v(e){y(this.input,"event: "+juse.toSpec(this.input.event)+", message: "+e.message)}function j(e,t){e.binder.notify?e.binder.notify(e,t):e.model.linkTile?e.model.linkTile.binder.notify(e,t):b(e.model,t,e)}function y(t,n){e.toggleClass(t.node,"error",!!n),!b(r("messages"),n,t)&&n&&u.log("error",n)}function b(e,t,n){if(function(e,t,n){if(e&&e.binder.update)return e.binder.update(e,t,n),!0}(e,t,n))return E(e,t,n),!0}function g(e){E(e,e.value)}function E(e,t,n){for(var r=!n||null===t||e.spec&&e.spec.kind?e.tiles:e.tiles.filter(N,n),o=0;o<r.length;o++)x(r[o],t,n)}function x(e,t,n){e&&e.binder.render&&e!==n&&e.binder.render(e,t,n)}function k(e,t){var n=null===t?null:s.call(e.scope,e.valid,t,e.spec);return y(e,n),!n}function T(e,t){var n=k(t,e.value);return e.valid=e.valid&&n,e}function N(e){return e.link?!!this.link:"map"==e.spec.kind||"input"!=e.spec.kind&&(this===juse.global||(this!==e&&function(e){return!this.name||!e.name||this.name===e.name}.call(this.spec,e.spec)?O.call(this.spec,e.spec)||juse.typeOf(e.specs,"array")&&e.specs.some(O,this.spec):void 0))}function O(e){return!this.member||this.member===e.member}}),this.juse("input.binder",["dom","widget","model","teval"],function(e,t,n,r){return juse.seal(function(n){n.valid=juse.toRef(e.data(n.node,"data-valid",null)),n.event=juse.toRef(e.data(n.node,"data-event",null));var r=juse.toRef(":",n.event,!0);r.kind=r.kind||function(e){switch(e.node.type){case"button":case"reset":return"click";case"checkbox":return"change";default:return"form"in e.node?"input":"click"}}(n),t.bindEvent(n.scope,n.node,r,o,n)},{render:i,clear:function(e,t){i(e,null,e),n.notifyInput(e,t)}});function o(e){n.fireEvent(e,function(e){switch(e.node.type){case"button":case"reset":return null;case"checkbox":return e.node.checked;default:return e.node.value}}(e))}function i(e,t,n){switch(t=e==n?t:r.call(e.scope,e.spec,e.model.value),e.node.type){case"button":case"reset":break;case"checkbox":e.node.checked=!!t;break;default:e.node.value=t||""}}}),this.juse("link.binder",["dom","widget","model"],function(e,t,n){return juse.seal(function(o){o.link=n.getModel(o.spec.name,!0),o.event=juse.toRef(e.data(o.node,"data-event",null)),t.bindEvent(o.scope,o.node,juse.toRef(":",o.event,!0),r,o)},{notify:function(e,t){e.model.linkTile?(n.notifyModel(e.model,t,e),n.notifyModel(e.model.linkTile.model.parentTile.model,t,e),i(e.model,e.model.linkTile,t)):e.link&&(n.notifyModel(e.link,t,e),e.model.spec?n.notifyModel(e.model,null,e):(o(e,t,e),i(e.link,e,t)))},render:o});function r(e){n.fireEvent(function(e){e.model.spec||(e.model.parentTile.model.index=e.model.parentTile.models.indexOf(e.model));return e}(e),e.link.linkTile==e?null:e.model.value)}function o(t,n,r){t.model.spec&&r?t.node.disabled=!!n:r&&(t.link.linkTile&&t.link.linkTile!=t&&e.toggleClass(t.link.linkTile.node,"selected"),e.toggleClass(t.node,"selected",!!n))}function i(e,t,n){null===n?(delete e.linkTile.model.parentTile.model.index,delete e.linkTile):e.linkTile=t}}),this.juse("list.binder",["dom","model"],function(e,t){return juse.seal(function(t){t.content=e.moveContent(t.node),t.models=[]},{update:function(e,t,n){var r=e.index;n&&r>=0?n.spec.member||(null===t?e.value.splice(r,1):e.value.splice(r,1,t)):n&&(n.model==e||n.link==e)&&t?(e.value=e.value||[],e.value.push(t)):e.value=t||null},render:function(n,r,o){var i=n.model.index;if(o&&i>=0)o.spec.member||(n.models[i].value=r),t.renderModel(n.models[i],r,o),null===r&&(e.removeContent(n.models[i].nodes),n.models.splice(i,1));else if(o&&(o.model==n.model||o.link==n.model)&&r)n.models.push(t.renderChild(n,r));else{for(i=0;i<n.models.length;i++)e.removeContent(n.models[i].nodes);if(n.models.length&&(n.models=[]),n.model.value)for(i=0;i<n.model.value.length;i++)n.models.push(t.renderChild(n,n.model.value[i]))}n.node.hidden=!n.models.length,e.toggleClass(n.node,"hidden",n.node.hidden)}})}),this.juse("map.binder",["dom","model"],function(e,t){return juse.seal(function(t){t.content=e.moveContent(t.node),t.models=[]},{update:function(e,t,n){var r=n&&n.spec.name+"#"+n.spec.member;e.value=e.value||{},r&&(t?e.value[r]=t:delete e.value[r])},render:function(n,r,o){var i=o&&o.spec.name+"#"+o.spec.member,s=i&&n.models[i];if(r)i&&!s?n.models.push(n.models[i]=t.renderChild(n,r)):s&&(s.value=r,t.renderModel(s,r));else if(s){var u=n.models.indexOf(s);e.removeContent(n.models[u].nodes),n.models.splice(u,1),delete n.models[i]}n.node.hidden=!n.models.length,e.toggleClass(n.node,"hidden",n.node.hidden)}})}),this.juse("remote.binder",["dom","widget","model","request"],function(e,t,n,r){return juse.seal(function(n){n.event=juse.toRef(e.data(n.node,"data-event",null)),t.bindEvent(n.scope,n.node,juse.toRef(":",n.event,!0),o,n),i(n)},{notify:function(e,t){n.notifyModel(n.getModel(e.spec),t,e)},load:i});function o(e){n.fireEvent(e,e.model.value)}function i(e){var t={input:e};r.call(e.scope,juse.toRef(".json",e.spec,!0)).then(n.resolveEvent.bind(t),n.rejectEvent.bind(t))}}),this.juse("text.binder",["model","teval"],function(e,t){var n=/%\{([^\}]*)\}/g;return juse.seal(function(t,r,o){var i=this;r.nodeValue=r.nodeValue.replace(n,function(t,n){var s=e.addTile.call(i,r,o,n);return s&&(s.content=r.nodeValue),""})},{render:function(r,o,i){r.node.nodeValue=r.content.replace(n,function(n,o){var i=(o=juse.toRef(o,r.model.spec,!0)).name?e.getModelValue(o.name):r.model.value;return t.call(r.scope,o,i)||""})}})}),this.juse("value.binder",["dom","teval"],function(e,t){return juse.seal(function(e){e.length=e.node.innerHTML.length},{update:function(e,t,n){n&&n.spec.member?(e.value=e.value||{},e.value[n.spec.member]=t):e.value=t},render:function(n,r,o){var r=t.call(n.scope,n.spec,n.model.value);n.length?n.node.hidden="hidden"==r:(n.node.hidden=!r,n.node.innerHTML=r||"");e.toggleClass(n.node,"hidden",n.node.hidden)}})})});