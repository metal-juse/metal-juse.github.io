/*!
 * Another AMD inspired JavaScript framework to load modules and manage dependencies.
 */
!function(e){"use strict";var t=["main","base","verbose","import"],n=["spec","value"],r=["key","kind","name","type","member","context"],i=r.concat("pipe","value"),o=[""].concat(i),s=/(?:\s*([^.#@|;\s]*)\s*=)?(?:\s*([^.#@|;\s]*)\s*:)?\s*([^.#@|;]*)(?:\.([^#@|;\s]*))?(?:#([^@|;\s]*))?(?:@([^|;\s]*))?(?:\s*\|\s*([^;\s]*))?(?:\s*;\s*([\S\s]*))?/,u=["=",":","",".","#","@","|",";"],a=/function\s*(\S*)\s*\([^)]*\)\s*{\s*((?:\/\*+!(?:[^*]|\*(?!\/))*\*+\/\s*)*)/,c=/\/\*+!\s*(?:@((?:[^\s*]|\*(?!\/))+))?\s*((?:[^*]|\*(?!\/))*)\*+\/\s*/,l=ce(["BUFFER","LOAD","DEFINE","RESOLVE","FLUSH","DONE","FAIL"]),f=ce(["error","warn","info","debug"]),d={buffer:[],errors:[],flushCount:0,moduleCount:0,global:e.document?e:global};return function(){d.global.juse||(d.global.juse={},d.global.document?(pe(d,{doc:d.global.document,script:re(),async:!!d.global.document.currentScript}),d.args=p(),d.args=pe({main:se(d.args.main||""),jusePath:ae(d.script.getAttribute("src"),-1)},d.args),d.doc.head!=d.script.parentNode&&d.doc.head.appendChild(d.script),v().import("juse/core",d.args.import),juse.follow(d.global,{load:m,hashchange:m})):(d.args=p(),d.args=pe({main:se(d.args.main||""),jusePath:__dirname},d.args),v().import("juse/core",d.args.import).then(m)))};function p(){return d.doc?t.reduce(function(e,t){var n="data-"+t;return e[t]=d.script.getAttribute(n)||d.script.hasAttribute(n),e},{}):process.argv.reduce(function(e,t,n){if(n<2||"-"==t||"-"!=t.charAt(0))return e;var r=t.substring(1).split("=");return e[r[0]]=r[1]||!0,e},{})}function h(){d.doc?be(d):be(d.args),be("--done:",ie())}function m(){var e=ie(se(d.doc?d.global.location.hash.substring(1):"",ie()));be("--load:",e),j(se(e.context,".context")).then(function(){j(e,"onload").then(function(t,n){n.fire("load",e)||me(t,"function")&&t(),n.fire("done",e)||setTimeout(h)})})}function v(){return b(".context",function(){function e(e,t,n){return e=se(e),C(t&&t.spec||ie()).scope.property(e)||je(n,e.name)||je(t,["properties",e.name])}function t(e,t){return A(e,w(t&&t.spec||ie()))}function n(e,n){return je(w(e=t(e,n)),["value",e.member])}function r(e,t){Object.keys(t).forEach(i,{target:e,follower:t})}function i(e){this.target.addEventListener(e,this.follower[e])}function o(e){return Object.keys(e).map(s,e)}function s(e){return this[e]}function u(e,n,r){if(e=se(e)){var i=w(n&&n.spec||ie());return r=void 0===r?_.call(i,t(e,n)):U(je(r=U(r,e,"type",i),[e.member]),e,"pipe",i)}}function a(e){var t=(e=se(e)).value;if(!t){var n=C(e),r=L(e,"js");t=[oe(r=n.kind?[n.name,r].join("/"):r)?"":d.doc?d.args.base:[".",d.args.base].filter(je).join("/"),t=oe(r)?d.args.jusePath:C(ie()).kind,e.kind,r].filter(je).join("/")}return t}b("juse",function(){d.global.juse=y({global:d.global,define:b,import:j,export:y,spec:se,specs:ue,path:a,slicePath:ae,property:e,resolve:t,lookup:n,filter:u,member:je,typeOf:me,values:o,follow:r,assign:fe,copy:pe,seal:le,log:be})}),b("juse/cache",function(){function e(){fe(this,{cacheInit:t,cacheEntry:n,cacheValue:r}),w(this.spec).cache={}}function t(t){return this.cacheInit||e.call(this),pe(w(this.spec).cache,t)}function n(e,t){var n=w(this.spec).cache;return n[e]=n[e]||t||{}}function r(e,t,n){var r=this.cacheEntry(e);return void 0!==n&&(r[t]=r[t]||n),r[t]}fe(this,{init:e})}),b("juse/context|juse/cache",function(){function e(){fe(this,{property:r})}function t(e){return e&&e.map&&n(e.map),e&&e.remap&&juse.values(e.remap).forEach(n),e}function n(e){e&&pe(e,juse.values(e).map(se),Object.keys(e),!0,!0)}function r(e,t){var n=(e=se(e)).kind?this.cacheValue("properties",e.kind,{}):this.cacheEntry("properties"),r=je(n,[e.name,e.member]);return r||void 0===t||(r=n[e.name]=n[e.name]||(e.member?{}:t),e.member&&(r=r[e.member]=r[e.member]||t)),r}e.call(this.context),this.cacheInit.call(this.context,t({map:{"*":"modules:",context:"juse/context@",cache:"juse/cache@",juse:"juse@"},roots:["juse","jx"]})),y(function(e){return this.cacheInit(t(e)),pe(this.cacheEntry("properties"),je(e,"properties")),{}}),fe(this,{init:e})}),b("juse/request",function(){function e(e){var n=juse.path(e),r=juse.specs(e),i="css"==e.type?"link":"script",o=d.doc.createElement(i);o.setAttribute("data-import",r),pe(o,"link"==i?{href:n,title:r,rel:"stylesheet"}:{src:n,async:d.async},null,!0,!0),be("load:",r,"<-",o),juse.follow(o,{load:t,error:t}),d.script.parentNode.insertBefore(o,d.script)}function t(e){var t=T(ne(e.target));"load"==e.type?"css"==t.type?t.flushState=l.DONE:ve(t)&&(t.flushState=l.DEFINE):"error"==e.type&&Z(t,null,null,Error("response "+e.type)),H()}function n(){if(this.error||4==this.xhr.readyState){200==this.xhr.status||0==this.xhr.status&&this.xhr.responseText?this.value=this.xhr.responseText:this.error||(this.error=Error(this.xhr.statusText||"Not Found"),this.error.code=this.xhr.status||404);var e=T(this.ref);this.error?Z(e,null,null,this.error):(e.def.args.value=this.value,e.flushState=l.DEFINE),H()}}y(function(t){return d.doc?"css"==t.type?e(t):"static"==t.kind?function(e){var t={ref:e,xhr:new XMLHttpRequest};try{t.xhr.open("GET",juse.path(e),!0),t.xhr.onreadystatechange=n.bind(t),t.xhr.send()}catch(e){t.error=e,n.call(t)}}(t):e(t):function(e){var t=juse.path(e);be("load:",juse.specs(e),"<-",t),d.currentSpec=e,require(t);var n=T(e);ve(n)&&(n.flushState=l.DEFINE)}(t)})})})}function j(e){var t=x(this);t.imports=d.buffer.slice.call(arguments).filter(je);var n=k(E(t),t);return t.importer=O(n,t),t}function b(e,t){var r=x(this);return O(k(E(r),r,function(e,t){t<n.length&&!me(e[0],"string")&&e.unshift("");return pe({},e,n)}([e,t],arguments.length)),r),delete r.importer,r}function g(e){return this.define(null,e)}function y(e){return d.exports=fe.apply(this,arguments)}function x(e){return e&&"currentSpec"in e?e:{import:j,then:g,define:b,currentSpec:E(e)}}function E(e){return e&&"currentSpec"in e?e.currentSpec:d.doc&&e?ne(re()):d.currentSpec}function k(e,t,n){var r;return n?(r={importer:t.importer,args:n},d.outerContext?(pe(r,se(r.args.spec)),r.context=d.outerContext.name):pe(r,se(r.args.spec,e)),pe(r,R(r,r,!0)),pe(r,function(e){var t=me(e,"function")&&a.exec(h.toString.call(e)),n={name:t[1],properties:{}};if(e=t[2]||"")for(;t=c.exec(e);){var r=t[1]||"value",i=t[2]||"";n.properties[r]=i.trim(),e=e.substring(t.index+t[0].length)}return n}(n.value),null,!0)):t?(r={imports:t.imports},d.outerContext?r.importer=d.outerContext:e?(r.importer=C(e),r.currentSpec=e):r.importer=d.context,pe(r,{context:r.importer.name})):r=pe({args:{}},e),r}function N(e){if(e&&!w(e))if(be("buffer:",ue(e)),ve(e))O(k(e));else{var t=S(k(e),l.BUFFER);t?d.buffer[ue(e)]=t:be("warn","fail to buffer",ue(e),"by",ue(this))}}function T(e){var t=ue(e),n=d.buffer[t];return n&&delete d.buffer[t],n}function O(e,t){var n=w(e);return n&&function(e){return e.flushState==l.FAIL}(n)&&D(e),n&&!P(n)||(be("define:",ue(e)),n&&(n.flushState=l.DONE),(n=S(e,l.DEFINE)).flow=t,d.context=d.context||n,d.buffer.some(G)||H()),n}function S(e,t){var n=pe({},e,i);if(D(e,n))return d.buffer.push(n),n.id=d.moduleCount++,n.flushState=t,n.def=e,n.scope={spec:pe({},e,r),properties:pe({},e.properties)},W(n)?n.modules={}:n.scope.context=C(n).scope,n}function C(e,t){var n=me(e,"object")?e.context||t:e;return n?je(d.context,["modules",n]):d.context}function w(e){return e&&(W(e)?C(e.name):me(L(e),"string")&&je(C(e),["modules",L(e)]))}function L(e,t){var n=me(e,"object")?e.name:e;return(t=e.type&&"context"!=e.type&&"js"!=e.type?e.type:t)?[n,t].join("."):n}function D(e,t){if(e.name){var n=C(e);if(n)n.modules[L(e)]=t;else if(e.context)return void be("warn","undefined context:",e.context)}return t}function M(e){var t=A(e,this.def.currentSpec||this);return t.value&&(t.value=juse.lookup("replace@juse/core")(t.value,this.scope)),t}function I(e){return A(e,this,!0)}function A(e,t,n){if(!(e=se({},e)).name||!t)return e;var r=R(e,t);return!n||r?(pe(e,r,i,!0,!0),r||(e.name=function(e,t){return["context"in e||e.name.indexOf("/")>=0?null:ae(t.name,-1)].concat(e.name.split("/")).filter(je).join("/")}(e,t)),e.type&&pe(e,R(L("*",e.type),t)),(e.context||t.context||W(t)||oe(e.name))&&pe(e,R("*",t)),pe(e,{kind:t.kind||C(t).kind,context:t.context})):void 0}function F(e){return e.name==this.name&&e.type==this.type&&e.context==this.context}function V(e){return!F.call(this,e)}function R(e,t,n){var r=me(e,"object")?L(e,e.type):e,i=L(t,t.type),o=i&&(je(C(d.args.main),["cache","remap",i,r])||je(C(t),["cache","remap",i,r]));return n?o:o||je(C(d.args.main),["cache","map",r])||je(C(t),["cache","map",r])||je(C(),["cache","map",r])||function(e,t){if(!("context"in e))return;var n={refKey:t},r=C(e);return(q.call(n,r)||r.imports.some(q,n))&&n.spec}(t,r)}function q(e){var t=w(e);return this.spec=W(t)&&je(t,["modules",this.refKey,"scope","spec"])}function _(e){var t=e&&w(e);if(t){var n=t.value;return e.member&&e.member!=t.member&&(n=je(n,[e.member])),U(n,e,"pipe",this)}}function U(e,t,n,r,i){return function(e,t,n){var r="type"==t?".":"|",i="type"==t?I:M;return e&&e[t]?e[t].split(r).map(i,n).filter(je):[]}(t,n,r).map(w).reduce(B,{module:r,filter:se(i),value:e}).value}function B(e,t){var n=t.def;return t=e.filter?je(t,[e.filter.name,e.filter.member]):je(t,"value"),e.value=me(t,"function")&&t.call(e.module.scope,e.value)||e.value,e.filter&&U(e.value,n,"pipe",e.module,e.filter),e}function H(){clearTimeout(d.flushTimeout),d.buffer.filter(W).forEach(Q),d.buffer.some(z)||d.buffer.forEach(Q),d.buffer.some(P)||d.buffer.forEach(te),!d.async&&d.buffer.some(X)||d.buffer.some(Y),d.flushCount>d.moduleCount?(be(d),be("--timeout--")):d.buffer.some(X)?(d.flushCount++,d.flushTimeout=setTimeout(ee,1e3)):(d.buffer=d.buffer.filter($),d.buffer.length?d.currentMain&&!d.buffer.some(X)&&(d.flushCount++,H()):d.flushCount=0)}function P(e){return e.flushState<l.DEFINE}function X(e){return e.flushState==l.LOAD}function G(e){return e.flushState>=l.RESOLVE}function $(e){return e.flushState<l.DONE}function K(e){return e.flushState>=l.FLUSH}function W(e){return"context"==e.type}function z(e){return W(e)&&G(e)}function J(e){var t=e.def?e:w(e);return!t||t==this||(z(t)?juse.values(t.modules).every(G):!this.imports.some(F,e))}function Q(e){if(e.flushState==l.DEFINE){if(e.imports=e.def.imports?e.def.imports.map(M,e):e.def.importer?e.def.importer.def.imports.map(M,e.def.importer):[],!e.imports.every(w)&&!C(e).imports.every(J,e))return;if(e.imports.length&&!d.currentMain)return;e.flushState=l.RESOLVE,e.def.imports?e.def.importer.imports.push.apply(e.def.importer.imports,e.imports.filter(V,e.def.importer)):e.def.type&&pe(e.def,R(L("*",e.def.type),e)),e.imports.forEach(N,e),e.def.imports?e.flushState=l.DONE:(me(e.value,"string")&&e.value||"static"==e.def.kind&&!e.def.args.value)&&!ve(e)&&(e.flushState=l.BUFFER,d.buffer[ue(e.def)]=e)}}function Y(e){if(e.flushState==l.BUFFER)return e.flushState=l.LOAD,juse.lookup("juse/request@")(e.def),!d.async}function Z(e,t,n,r){(r||P(e))&&(e.flushState=l.FAIL,e.value=r||Error("timeout error"),d.errors.push(e.value),be("error",ue(e.def),e.value))}function ee(){d.buffer.forEach(Z),H()}function te(e){if(e.flushState==l.RESOLVE||e.flushState==l.FLUSH){var t=e.imports.map(w).filter(je);if(e.flushState==l.RESOLVE){if(!t.every(G))return;e.flushState=l.FLUSH,t.forEach(te)}if(!t.every(K))return;if(e.flushState==l.DONE)return;try{be("init:",ue(e.def)),d.outerContext=W(e)?e:C(e),function(e){if(e.value=(me(e.def.args.value,"function")?e.def.properties.value:e.def.args.value)||ve(e,!0),U(e.value,e.def,"type",e,"scope#init"),U(e.value,e.def,"pipe",e,"scope#init"),delete d.exports,me(e.def.args.value,"function")){var t=e.imports.map(_,e);!t.length&&"exports"in e.flow&&t.push(e.flow.exports),t.push(e.scope),e.scope.value=e.value;var n=e.def.args.value.apply(e.scope,t)||d.exports;void 0!==n&&(e.flow.exports=n),e.value=n||e.value,delete e.scope.value}delete e.flow,delete d.exports,e.value=U(e.value,e.def,"type",e),e.value=U(e.value,e.def,"pipe",e)}(e),e.flushState=l.DONE}catch(t){Z(e,0,0,t)}finally{delete d.outerContext}}}function ne(e){return se(e.getAttribute("data-import"))}function re(e){return d.global.document.currentScript||d.script&&d.script.previousElementSibling||(e=d.global.document.getElementsByTagName("script"))[e.length-1]}function ie(e){return(d.currentMain=e||d.currentMain)||d.args.main}function oe(e){return!d.context.cache||d.context.cache.roots.indexOf(e.split("/")[0])>=0}function se(e,t,n){return me(e,"string")&&(e=pe({},s.exec(e),o)),me(t,"string")&&(t=pe({},s.exec(t),o)),me(t,"object")||(t=null),(e=pe(e,t,n=me(n,"array")&&n||n&&e&&Object.keys(e)||i,!0))&&e.name&&(e.name=e.name.trim()),e}function ue(e){for(var t=[],n=0;n<i.length;n++){var r=e[i[n]],o=u[n];(r||"string"==typeof r&&o)&&(n>1?t.push(o,r):t.push(r,o))}return t.join("")}function ae(e,t,n,r){if(!e)return e;t=t||0,r=r||"/";var i=e.split(r),o=(n=arguments.length>2?n:t<0?t:i.length-t)>0;n=n>0?n:-n;var s=i.splice(t,n);return(o?s:i).join(r)}function ce(e){for(var t=0;t<e.length;t++)e[e[t]]=t;return le(e)}function le(e,t){return Object.freeze(fe.apply(this,arguments))}function fe(e,t){if(!e||!t)return e;for(var n=1;n<arguments.length;n++)de.call(e,arguments[n]);return e}function de(){for(var e=0;e<arguments.length;e++){var t=arguments[e],n=me(t,"function")&&a.exec(h.toString.call(t))[1];n?he(this,n,t):me(t,["array","arguments"])?de.apply(this,t):pe(this,t)}}function pe(e,t,n,r,i){if(!e||!t)return e;for(var o=me(t,["array","arguments"])?n:Object.keys(t),s=0;s<o.length;s++){var u=o[s];he(e,u,o===n?t[s]:t[u],n,r,i)}return e}function he(e,t,n,r,i,o){t&&(r&&r.indexOf(t)<0||(n||"string"==typeof n)&&(e.propertyIsEnumerable(t)&&!i||e[t]&&!o||(e[t]=n)))}function me(e,t,n){var r=typeof e;return"object"==r&&(r=(r=d.toString.call(e)).substring(8,r.length-1).toLowerCase()),t?n?0==r.indexOf(t):d.buffer.constructor===t.constructor?t.indexOf(r)>=0:t==r:r}function ve(e,t){var n=d.doc&&d.doc.getElementById(L(e));return t&&n&&n.parentNode.removeChild(n),n||je(d.global,e.member||e.name)}function je(e,t,n){var r;if(t=me(t,"string")?t.split("."):t)for(var i=0;i<t.length&&(me(r=t[i],"string")&&e);i++)e=!me(e,"string")&&r in e?e[r]:r=null;return!0===n?me(r,"string")&&r:e}function be(e){if(d.args.verbose&&"undefined"!=typeof console)if("string"==typeof e){var t=f.indexOf(e);(t<0?console.log:console[f[t]]).apply(console,arguments)}else console.dir(e)}}(this)(),juse.define("juse/run.context",function(){juse.define("try",function(){juse.export(function(e,t,n,r){try{return e.apply(r,t)}catch(e){return n&&(n.ex=e),n}})}).define("async",function(e){var t="function"==typeof setImmediate?setImmediate:setTimeout,n=[];function r(){for(var t={};n.length;)e(n.shift(),null,t)===t&&juse.log("error",t.ex)}juse.export(function(e){n.length||t(r),n.push(e)})}),juse.import("try","async").define("promise",function(e,t){var n,r={};function i(t){if("function"!=typeof t)throw TypeError("not a function: "+t);var n=s();return e(c,[n,t],r)===r&&d(n,"rejected",r.ex),n.handle}function o(e,t){return e&&e[t]}function s(e,t,r){var i={depth:0};return i.handle=new function(e,t){this.then=e,this.catch=t}(u.bind(i),u.bind(i,null)),e&&(e.children=e.children||[],e.children.push(i),i.fulfilled=t,i.rejected=r),n&&(n.inner=i,i.outer=n),i}function u(e,t){var n=s(this,e,t);return f.call(this,n),n.handle}function a(e,t,n){this.depth>=e||this.state||(this.depth=e,d(this,t,n)&&l(this))}function c(e,t,n){t.call(n,a.bind(e,e.depth+1,"fulfilled"),a.bind(e,e.depth+1,"rejected"))}function l(e){e.state&&(e.children?e.children.forEach(f,e):e.outer&&f.call(e,e.outer))}function f(i){var o=this;o.state&&!i.state&&t(function(){(function(t,i){if(!i.state||t.state)return;var o=i.state,s=i.value;"function"==typeof t[o]&&(n=t,(s=e(t[o],[s],r))!==r?o="fulfilled":(s=r.ex,o="rejected"),n=null);return d(t,o,s)})(i,o)&&l(i)})}function d(t,n,i){if(t.handle===i)i=TypeError("cyclic promise"),n="rejected";else if(t.inner&&t.inner.handle===i)for(var s=t.inner;s;){if(s.state){n=s.state,i=s.value;break}s=s.inner}var u=e(o,[i,"then"],r);if(u===r&&(i=r.ex,n="rejected"),"function"==typeof u&&("object"==typeof i||"function"==typeof i)&&"fulfilled"==n){var a=t.depth;if(e(c,[t,u,i],r)!==r||a<t.depth)return!1;i=r.ex,n="rejected"}return t.state=n,t.value=i,!0}juse.export(i,{resolve:function(e){return i(function(t,n){t(e)})},reject:function(e){return i(function(t,n){n(e)})}})})}),juse.import("juse/run").define("juse/core.context",function(){juse.define("replace",function(){var e=/\$\{([^\}]+)\}/g;juse.export(function(t,n){return t&&"string"==typeof t&&e.test(t)?t.replace(e,function(e,t){return juse.property(t,n)||e}):t})}),juse.define("map",function(){juse.export(function(e){for(var t={},n=juse.spec(e);n&&n.name;n=juse.spec(n.value))t[n.key||""]=n.name;return t})}),juse.define("event|cache",function(){function e(e,t){juse.typeOf(t,"function")&&i(e,this).push(t)}function t(e){juse.follow(this,juse.assign({},arguments))}function n(e,t,n){var o={value:t,error:n};return i(e,this).forEach(r,o),o.result}function r(e){try{this.result=this.result||e(this.value,this.error)}catch(e){juse.log("error",e)}}function i(e,t){return t.cacheValue("callbacks",e,[])}juse.export(function(e){return juse.seal(e||function(){},{addEventListener:this.addEventListener.bind(this),follow:this.follow.bind(this),fire:this.fire.bind(this)})}),juse.assign(this,{init:function(){juse.assign(this,{addEventListener:e,follow:t,fire:n})}})}),juse.define("onload|event"),juse.import("promise").define("service|event",function(e){function t(e){return juse.assign(this.cacheEntry("providers"),arguments)}function n(t,n){var r=juse.spec(t),i=juse.member(this.provide(),r.member),o={value:n};return e(i.bind(o)).then(e.resolve,e.reject)}juse.export(function(e){return juse.seal(e||function(){},{addEventListener:this.addEventListener.bind(this),follow:this.follow.bind(this),fire:this.fire.bind(this),provide:this.provide.bind(this),submit:this.submit.bind(this)})}),juse.assign(this,{init:function(){juse.assign(this,{provide:t,submit:n})}})})}),juse.import("juse/core").define("juse/text.context",function(){juse.import("teval").define("replace",function(e,t){var n=/\$\{([^\}]+)\}/g;juse.export(function(r,i){e=e||juse.lookup("teval",t);var o=this,s=arguments;return r&&"string"==typeof r&&n.test(r)?r.replace(n,function(t,n){var r=t,u=parseInt(n)+1;return u?u in s&&(r=s[u]):r=e.call(o,n,i)||r,r}):r})}),juse.import("replace","map").define("teval",function(e,t,n){juse.export(function(n,r){var i=juse.spec(n),o=juse.property(i,this,r)||juse.filter(i,this,r),s=juse.filter(i.value,this)||t(i.value);if(s){o=juse.typeOf(o,"array")&&!o.length||juse.typeOf(o,"object")&&!Object.keys(o).length?null:o;var u=juse.member(s,[o],!0)?juse.member(s,[o]):o&&"*"in s?s["*"]:!o&&""in s?s[""]:o;u!==o&&(o=e.call(this,u,o))}return o})})}),juse.define("juse/resource.context",function(){juse.define("properties",function(){juse.export(function(e){if(juse.member(this.spec,"key",!0)){var t=this.spec.key||juse.slicePath(this.spec.name,-1,1);juse.copy(this.context.cacheValue("properties",t,{}),e)}else juse.copy(this.context.cacheEntry("properties"),e)})}),juse.define("json",function(){juse.export(function(e){return JSON.parse(e)})}),juse.define("html",function(){juse.export(function(e,t){if(juse.typeOf(e,"html",!0))return e;var n=juse.global.document.createElement(t||"div");return n.innerHTML=e,n})})}),juse.import("juse/run").define("juse/remote.context",function(){function e(e){this.xhr.setRequestHeader(e,this.args.headers[e])}function t(e){return juse.typeOf(e,"object")?Object.keys(e).map(n,e).join("&"):e}function n(e){return[encodeURIComponent(e),encodeURIComponent(this[e])].join("=")}juse.import("promise").define("request",function(n){juse.export(function(r,i){var o={spec:r,url:juse.path(juse.resolve(r,this)),args:i||{},scope:this};return n(function(n,r){try{(function(n,r){this.xhr=new XMLHttpRequest;var i=(this.args.method||"GET").toUpperCase();switch(i){case"GET":this.data=null,this.xhr.open(i,[this.url,t(this.args.data)].filter(juse.member).join("?"),!0);break;case"POST":this.data=t(this.args.data),this.xhr.open(i,this.url,!0),this.xhr.setRequestHeader("Content-Length",this.data.length),this.xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");break;default:throw Error("method not supported: "+i)}this.xhr.onreadystatechange=function(e,t){if(4==this.xhr.readyState){if(200==this.xhr.status||0==this.xhr.status&&this.xhr.responseText)try{this.value=juse.filter(this.spec,this.scope,this.xhr.responseText)}catch(e){this.error=e}else this.error=Error(this.xhr.statusText||"Not Found"),this.error.code=this.xhr.status||404;this.error?t.call(this.scope,this.error):e.call(this.scope,this.value)}}.bind(this,n,r),this.args.headers&&Object.keys(this.args.headers).forEach(e,this);return this.xhr}).call(this,n,r).send(this.data)}catch(e){r.call(this.scope,e)}}.bind(o))})})}),juse.import("juse/resource","juse/text","juse/core").define("juse/ui.context",function(){var e,t,n=[];juse.import("html","onload").define("view",function(n,r,i){r.follow({load:function(r){e=e||juse.global.document.body.querySelector("[data-view]")||juse.global.document.body;var i=n(juse.lookup(r));t.closest(i,e)||(e.lastElementChild?e.replaceChild(i,e.lastElementChild):e.appendChild(i))}}),juse.export(function(){i.context.cacheValue("views",this.spec.name,this.spec)})}),juse.import("html").define("dom",function(e){function r(e,t){if(t="string"==typeof(t=t||juse.global.document.createDocumentFragment())?juse.global.document.createElement(t):t,juse.typeOf(e,"array"))e.forEach(i,t);else for(;e.firstChild;)i.call(t,e.firstChild);return t}function i(e){this.parentNode?this.parentNode.insertBefore(e,this):this.insertBefore(e,null)}function o(e){e.parentNode&&e.parentNode.removeChild(e)}function s(e,t){return n.reduce.call(e,u,t)}function u(e,n){return n.nodeType==t.ELEMENT_NODE&&(e.callback?(e.name&&!n.hasAttribute(e.name)||e.callback.call(e.scope,n),e.nodes.push(n.childNodes)):n.hasAttribute(e.name)&&(e.nodes[n.getAttribute(e.name)]=n)),e}function a(e){if(e.nodeType==t.ELEMENT_NODE){var n="string"!=typeof this.selectors?e===this.selectors:e.matches?e.matches(this.selectors):e.parentNode.querySelector(this.selectors)==e;return this.node=n&&e}}function c(e,t){return t.name.indexOf("data-")||(e[t.name.substring(5)]=t.value),e}function l(e,r){var i=(r=r||e.nodeType!=t.ELEMENT_NODE&&"*")?e.querySelectorAll(r):e.getElementsByTagName("*");return n.slice.call(i)}function f(e){return e.nodeType==t.ATTRIBUTE_NODE||e.nodeType==t.TEXT_NODE}t=juse.export(function(t,n){return juse.typeOf(t,"string")?e.call(this,t):n?t.cloneNode(!0):t},{TEXT_NODE:juse.global.document.TEXT_NODE,ELEMENT_NODE:juse.global.document.ELEMENT_NODE,ATTRIBUTE_NODE:juse.global.document.ATTRIBUTE_NODE,moveContent:r,replaceContent:function(e,t){e&&e.parentNode&&t&&(r(t,e),e.parentNode.removeChild(e))},removeContent:function(e){if(juse.typeOf(e,"array"))e.forEach(o);else for(;e.firstChild;)o(e.firstChild)},childNodes:function(e,t){return t?e?s(e.childNodes,{name:t,nodes:{}}).nodes:{}:n.slice.call(e.childNodes)},forNodes:function(e,t,n,r){r={name:t,nodes:[e.childNodes],callback:n,scope:r};for(var i=0;i<r.nodes.length;i++)s(r.nodes[i],r)},closest:function(e,t){for(var r={selectors:t},i=e.parentNode;i;i=i.parentNode)if(e=n.some.call(i.childNodes,a,r)&&r.node)return e},filterNodes:function(e,t){return l(e,"["+t+"]")},selectNodes:l,bindNodes:function(e,t,r){return n.forEach.call(e.querySelectorAll(t),r),e},data:function(e,n,r){if(e.nodeType==t.ELEMENT_NODE){var i=e.getAttribute(n);return null===r?e.removeAttribute(n):void 0!==r&&e.setAttribute(n,r),i}},values:function(e){return n.reduce.call(e.attributes,c,{})},textNode:f,forTextNodes:function(e,t,r){e&&n.filter.call(e,f).forEach(t,r)},toggleClass:function(e,t,n){var r=e.className?e.className.split(" "):[],i=r.indexOf(t);0!=n&&i<0?r.push(t):1!=n&&i>=0&&r.splice(i,1);t=r.join(" "),e.className!=t&&(e.className=t)},hasClass:function(e,t){return e.className&&e.className.split(" ").indexOf(t)>=0}})}),juse.import("dom","replace@juse/text").define("template",function(e,t){var n=[];function r(t){t.nodeType==e.ELEMENT_NODE&&(n.forEach.call(t.attributes,i,this),n.forEach.call(t.childNodes,i,this))}function i(n){n.nodeType!=e.ATTRIBUTE_NODE&&n.nodeType!=e.TEXT_NODE||(n.nodeValue=t.call(this.scope,n.nodeValue,this.dataset))}juse.export(function(t,n){return function(t,n,i){var o={dataset:n,scope:i};return e.selectNodes(t).forEach(r,o),r.call(o,t),t}(t,n,this)}),juse.assign(this,{init:function(t){juse.copy(this.properties,e.values(t))}})}),juse.import("dom","widget","map").define("tile",function(e,t,n){function r(t,n,r,o,s){return function(t,n,r,o,s){var u=n?Object.keys(n).join(","):null,a={dataset:r,names:u,scope:o,outertag:s,tiles:n||e.childNodes(s,"data-tile")};u?e.selectNodes(t,u).forEach(i,a):e.filterNodes(t,"data-tag").forEach(i,a)}(t,n,r,o,s),t}function i(i){var o=this.names&&i.tagName.toLowerCase()||i.getAttribute("data-tag"),s=o&&juse.spec(o),u=null;if(u=!s&&this.outertag?this.outertag:this.tiles[s.name]?e(this.tiles[s.name]):(u=s&&juse.filter(juse.spec(s,".html"),this.scope))&&u.cloneNode(!0)){var a=this.names?e.values(i):n(s.value);u=r(u,null,this.dataset||a,this.scope,i),e.replaceContent(i,t.call(this.scope,u))}else juse.log("warn","tile not found",o)}juse.export(function(e,t,n){return r(e,t,n,this)})}),juse.import("dom").define("widget",function(e){var t=["click","dblclick","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseout","mouseup","input","change","keyup","keydown","keypress"],n={enter:juse.spec("keyup:13")};function r(t){var n=juse.spec(e.data(t,"data-widget",null)),r=juse.lookup(n,this);r&&juse.typeOf(r.bindWidget,"function")?r.bindWidget.call(this,t):juse.typeOf(r,"function")&&r.call(this,t),i(this,t,n)}function i(t,n,r){e.filterNodes(n,"data-event").forEach(o,{scope:t,base:r})}function o(t){for(var n=e.data(t,"data-event",null);n;){var r=juse.spec(n,this.base);if(!s(this.scope,t,r)){e.data(t,"data-event",n);break}n=r.value}}function s(e,n,r,i,o){var s=juse.spec(r);if(s){var a=u(s),c=a&&a.kind||s.kind||t[0];if(t.indexOf(c)>=0&&(i=i||juse.lookup(s,e),juse.typeOf(i,"function"))){var l={action:i,target:o,event:s},f={};return f[c]=function(e){var t=u(this.event);if(t&&t.name!=e.keyCode)return;this.target?this.action.call(null,this.target,e):this.action.call(null,e)}.bind(l),juse.follow(n,f),!0}}}function u(e){return n[e.kind]}juse.export(function(t,n){return function(t,n){e.filterNodes(t,"data-widget").forEach(r,n),i(n,t)}(t=e.call(this,t),n||this),t},{bindEvent:s})})}),juse.import("juse/text").define("juse/valid.context",function(e,t){juse.define("validator",function(){juse.export(function(e){t.cacheValue("validators",this.spec.name,e)})}),juse.define("validate",function(){function e(e,t){return t&&(e=e||[]).push(t),e}juse.export(function(n,r,i){var o;for(n=juse.spec(n);n;n=juse.spec(n.value)){var s=n.kind||n.name,u=t.cacheValue("validators",s);o=e(o,juse.typeOf(u,"function")&&u.call(this,n,r,i))}return o})}),juse.import("replace").define("required|validator",function(e){juse.export(function(t,n,r){return n?"":e(juse.property("#required.message",this)||"required: ${0}",juse.specs(r))})})}),juse.import("juse/remote","juse/core","juse/ui","juse/valid","juse/text").define("juse/model.context",function(){var e=["kind","name"],t=this;function n(e){return juse.lookup(t.cacheValue("binders",e))||juse.lookup(t.cacheValue("binders","value"))}function r(r,i){var o=(r=juse.spec(r))&&t.cacheValue("models",r.name);return!o&&i&&(o={tiles:[],value:null},r&&(o.spec={},t.cacheValue("models",r.name,o))),o&&i&&(juse.copy(o.spec,r,e),o.binder=n(o.spec&&o.spec.kind)),o}juse.define("binder",function(){juse.export(function(){t.cacheValue("binders",this.spec.name,this.spec)})}),juse.import("dom","tile","validate","onload").define("model",function(e,i,o,s){function u(t){var n=r(e.data(t,"data-model",null),!0);return a.call(this,t,n),n}function a(t,n){var r={scope:this,model:n};e.forNodes(t,"data-value",l,r),e.selectNodes(t).forEach(c,r),c.call(r,t)}function c(t){e.forTextNodes(t.attributes,l,this),e.forTextNodes(t.childNodes,l,this)}function l(t){var r=n(f(t,e.data(t,"data-value"),this.model&&this.model.spec));if(r){var i=e.data(t,"data-value",null),o=d.call(this.scope,t,this.model,i);r.call(this.scope,o,t,this.model)}}function f(t,n,r){return n&&juse.spec(n,r,!0).kind||(e.textNode(t)?"text":"form"in t?"input":"")}function d(e,t,i){if(i=juse.spec(i,t&&t.spec,!0)){var o={node:e},s=(t=(i.kind||t&&!t.spec)&&t||r(i,!0)).tiles.some(p,o)&&o.tile;return s?(s.specs=s.specs||[],s.specs.push(i)):(s={node:e,spec:i,binder:n(f(e,i)),model:t,scope:this},t.tiles.push(s)),s}}function p(e){return this.tile=e,this.node==e.node}function h(e){v(this.input,e)}function m(e){j(this.input,"event: "+juse.specs(this.input.event)+", message: "+e.message)}function v(e,t){e.binder.notify?e.binder.notify(e,t):e.model.linkTile?e.model.linkTile.binder.notify(e,t):b(e.model,t,e)}function j(t,n){e.toggleClass(t.node,"error",!!n),!b(r("messages"),n,t)&&n&&juse.log("error",n)}function b(e,t,n){if(function(e,t,n){if(e&&e.binder.update)return e.binder.update(e,t,n),!0}(e,t,n))return y(e,t,n),!0}function g(e){y(e,e.value)}function y(e,t,n){for(var r=!n||null===t||e.spec&&e.spec.kind?e.tiles:e.tiles.filter(N,n),i=0;i<r.length;i++)x(r[i],t,n)}function x(e,t,n){e&&e.binder.render&&e!==n&&e.binder.render(e,t,n)}function E(e,t){var n=null===t?null:o.call(e.scope,e.valid,t,e.spec);return j(e,n),!n}function k(e,t){var n=E(t,e.value);return e.valid=e.valid&&n,e}function N(e){return e.link?!!this.link:"map"==e.spec.kind||"input"!=e.spec.kind&&(this===juse.global||(this!==e&&function(e){return!this.name||!e.name||this.name===e.name}.call(this.spec,e.spec)?T.call(this.spec,e.spec)||juse.typeOf(e.specs,"array")&&e.specs.some(T,this.spec):void 0))}function T(e){return!this.member||this.member===e.member}s.follow({load:function(){var e=t.cacheEntry("models");juse.values(e).forEach(g)}}),juse.export(function(t){return t=e.call(this,t),function(t){e.filterNodes(t,"data-model").forEach(u,this),a.call(this,t)}.call(this,t),t},{renderChild:function(t,n){var r=i.call(t.scope,t.content.cloneNode(!0)),o=u.call(t.scope,r);return o.nodes=e.childNodes(r),o.parentTile=t,o.value=n,y(o,n),t.node.appendChild(e.moveContent(o.nodes)),o},renderModel:y,fireEvent:function(e,t){(function(e,t){return e.spec.member?E(e,t):e.model.tiles.reduce(k,{value:t,valid:!0}).valid})(e,t)&&e.event&&(e.event.name||e.event.member)?function(e,t){var n={input:e},r=e.binder[e.event.member];juse.typeOf(r,"function")?r(e,t):juse.lookup(e.event.name,e.scope).submit(e.event,t).then(h.bind(n),m.bind(n))}(e,t):v(e,t)},notifyInput:v,addTile:d,getModel:r,getModelValue:function(e){var t=r(e=juse.spec(e));return t.value&&e.member?t.value[e.member]:t.value},notifyModel:b,resolveEvent:h,rejectEvent:m})}),juse.import("dom","widget","model","teval").define("input|binder",function(e,t,n,r){function i(e){n.fireEvent(e,function(e){switch(e.node.type){case"button":case"reset":return null;case"checkbox":return e.node.checked;default:return e.node.value}}(e))}function o(e,t,n){switch(t=e==n?t:r.call(e.scope,e.spec,e.model.value),e.node.type){case"button":case"reset":break;case"checkbox":e.node.checked=!!t;break;default:e.node.value=t||""}}juse.export(function(n){n.valid=juse.spec(e.data(n.node,"data-valid",null)),n.event=juse.spec(e.data(n.node,"data-service",null));var r=juse.spec(":",n.event,!0);r.kind=r.kind||function(e){switch(e.node.type){case"button":case"reset":return"click";case"checkbox":return"change";default:return"form"in e.node?"input":"click"}}(n),t.bindEvent(n.scope,n.node,r,i,n)},{render:o,clear:function(e,t){o(e,null,e),n.notifyInput(e,t)}})}),juse.import("dom","widget","model").define("link|binder",function(e,t,n){function r(e){n.fireEvent(function(e){e.model.spec||(e.model.parentTile.model.index=e.model.parentTile.models.indexOf(e.model));return e}(e),e.link.linkTile==e?null:e.model.value)}function i(t,n,r){t.model.spec&&r?t.node.disabled=!!n:r&&(t.link.linkTile&&t.link.linkTile!=t&&e.toggleClass(t.link.linkTile.node,"selected"),e.toggleClass(t.node,"selected",!!n))}function o(e,t,n){null===n?(delete e.linkTile.model.parentTile.model.index,delete e.linkTile):e.linkTile=t}juse.export(function(i){i.link=n.getModel(i.spec.name,!0),i.event=juse.spec(e.data(i.node,"data-service",null)),t.bindEvent(i.scope,i.node,juse.spec(":",i.event,!0),r,i)},{notify:function(e,t){e.model.linkTile?(n.notifyModel(e.model,t,e),n.notifyModel(e.model.linkTile.model.parentTile.model,t,e),o(e.model,e.model.linkTile,t)):e.link&&(n.notifyModel(e.link,t,e),e.model.spec?n.notifyModel(e.model,null,e):(i(e,t,e),o(e.link,e,t)))},render:i})}),juse.import("dom","model").define("list|binder",function(e,t){juse.export(function(t){t.content=e.moveContent(t.node),t.models=[]},{update:function(e,t,n){var r=e.index;n&&r>=0?n.spec.member||(null===t?e.value.splice(r,1):e.value.splice(r,1,t)):n&&(n.model==e||n.link==e)&&t?(e.value=e.value||[],e.value.push(t)):e.value=t||null},render:function(n,r,i){var o=n.model.index;if(i&&o>=0)i.spec.member||(n.models[o].value=r),t.renderModel(n.models[o],r,i),null===r&&(e.removeContent(n.models[o].nodes),n.models.splice(o,1));else if(i&&(i.model==n.model||i.link==n.model)&&r)n.models.push(t.renderChild(n,r));else{for(o=0;o<n.models.length;o++)e.removeContent(n.models[o].nodes);if(n.models.length&&(n.models=[]),n.model.value)for(o=0;o<n.model.value.length;o++)n.models.push(t.renderChild(n,n.model.value[o]))}n.node.hidden=!n.models.length,e.toggleClass(n.node,"hidden",n.node.hidden)}})}),juse.import("dom","model").define("map|binder",function(e,t){juse.export(function(t){t.content=e.moveContent(t.node),t.models=[]},{update:function(e,t,n){var r=n&&n.spec.name+"#"+n.spec.member;e.value=e.value||{},r&&(t?e.value[r]=t:delete e.value[r])},render:function(n,r,i){var o=i&&i.spec.name+"#"+i.spec.member,s=o&&n.models[o];if(r)o&&!s?n.models.push(n.models[o]=t.renderChild(n,r)):s&&(s.value=r,t.renderModel(s,r));else if(s){var u=n.models.indexOf(s);e.removeContent(n.models[u].nodes),n.models.splice(u,1),delete n.models[o]}n.node.hidden=!n.models.length,e.toggleClass(n.node,"hidden",n.node.hidden)}})}),juse.import("dom","widget","model","request").define("remote|binder",function(e,t,n,r){function i(e){n.fireEvent(e,e.model.value)}function o(e){var t={input:e};r.call(e.scope,juse.spec(".json",e.spec,!0)).then(n.resolveEvent.bind(t),n.rejectEvent.bind(t))}juse.export(function(n){n.event=juse.spec(e.data(n.node,"data-service",null)),t.bindEvent(n.scope,n.node,juse.spec(":",n.event,!0),i,n),o(n)},{notify:function(e,t){n.notifyModel(n.getModel(e.spec),t,e)},load:o})}),juse.import("model","teval").define("text|binder",function(e,t){var n=/%\{([^\}]*)\}/g;juse.export(function(t,r,i){var o=this;r.nodeValue=r.nodeValue.replace(n,function(t,n){var s=e.addTile.call(o,r,i,n);return s&&(s.content=r.nodeValue),""})},{render:function(r,i,o){r.node.nodeValue=r.content.replace(n,function(n,i){var o=(i=juse.spec(i,r.model.spec,!0)).name?e.getModelValue(i.name):r.model.value;return t.call(r.scope,i,o)||""})}})}),juse.import("dom","teval").define("value|binder",function(e,t){juse.export(function(e){e.length=e.node.innerHTML.length},{update:function(e,t,n){n&&n.spec.member?(e.value=e.value||{},e.value[n.spec.member]=t):e.value=t},render:function(n,r,i){var r=t.call(n.scope,n.spec,n.model.value);n.length?n.node.hidden="hidden"==r:(n.node.hidden=!r,n.node.innerHTML=r||"");e.toggleClass(n.node,"hidden",n.node.hidden)}})})});